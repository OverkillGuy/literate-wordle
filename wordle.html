<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-03-21 Mon 02:09 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Wordle</title>
<meta name="author" content="Jb Doyon" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Wordle</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org628c0d2">1. Mise en bouche: picking an answer</a>
<ul>
<li><a href="#org83cb713">1.1. Solution dictionary file</a></li>
<li><a href="#org1a362bc">1.2. TDD for picking word functionality</a></li>
<li><a href="#orgda284ce">1.3. Importing dictionary: static/packaged asset file read</a></li>
<li><a href="#org30c8928">1.4. Debriefing on the method</a></li>
</ul>
</li>
<li><a href="#org9a36b59">2. Confirming guess is a valid word</a>
<ul>
<li><a href="#orgaf7e508">2.1. Test setup</a></li>
<li><a href="#org335116f">2.2. Implementing the feature, one test at a time</a></li>
<li><a href="#orgabe36c7">2.3. Performance trick</a></li>
<li><a href="#orge8afa44">2.4. Tangle out all the code</a></li>
</ul>
</li>
<li><a href="#org786c0aa">3. Calculating guessed word&rsquo;s score</a>
<ul>
<li><a href="#orgd9e5b78">3.1. Can we start coding yet?</a></li>
<li><a href="#org0529797">3.2. Finalizing the scenarios</a></li>
<li><a href="#org7b5440a">3.3. Writing up acceptance tests</a></li>
<li><a href="#orga75603e">3.4. More tests</a></li>
<li><a href="#orgbe32fa7">3.5. Implementing the feature</a></li>
<li><a href="#org437d242">3.6. Tangle it all out</a></li>
</ul>
</li>
<li><a href="#org77562de">4. Playing a round of Wordle</a>
<ul>
<li><a href="#orgf59ce5b">4.1. Implementing the feature</a></li>
<li><a href="#org8ebf31d">4.2. Tangling out the whole thing</a></li>
</ul>
</li>
<li><a href="#org057af63">5. Final round: command line interface</a>
<ul>
<li><a href="#org1771393">5.1. Tangling it out</a></li>
<li><a href="#org57b18c3">5.2. Launching as CLI</a></li>
</ul>
</li>
<li><a href="#orga4a8388">6. Conclusion</a></li>
</ul>
</div>
</div>
<p>
Implementing the viral game &ldquo;Wordle&rdquo; in Python using literate programming!
</p>

<p>
Literate programming is the art of writing code as if it was a novel (or
blogpost), writing down what&rsquo;s needed, explaining the reasoning, and weaving in
code snippets that add up to the codebase as we grow in understanding. The
result is a &ldquo;story&rdquo; which can be read, but also &ldquo;tangled&rdquo; back into a proper
codebase that works normally.
</p>

<p>
I&rsquo;ll be making liberal use of Gherkin to describe what we&rsquo;re building.
</p>

<div id="outline-container-org628c0d2" class="outline-2">
<h2 id="org628c0d2"><span class="section-number-2">1.</span> Mise en bouche: picking an answer</h2>
<div class="outline-text-2" id="text-1">
<p>
To get us started, let&rsquo;s cover the very first thing Wordle has to do: pick a
word that will become our answer:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>Our first requirement</label><pre class="src src-feature"><span style="color: #51afef;">Feature:</span><span style="color: #ECBE7B;"> Pick an answer word</span>
  As a Wordle game
  I need to pick a random 5 letter word
  In order to let players guess it
</pre>
</div>

<p>
Right. That&rsquo;s fairly straightforward, but the secret word can&rsquo;t be random
characters, it needs to be a proper word. So we need to find a dictionary to
pick from.
</p>
</div>
<div id="outline-container-org83cb713" class="outline-3">
<h3 id="org83cb713"><span class="section-number-3">1.1.</span> Solution dictionary file</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Since we&rsquo;re trying to match the Wordle website, let&rsquo;s use Wordle&rsquo;s own
dictionary. Someone <a href="https://raw.githubusercontent.com/AllValley/WordleDictionary/main/wordle_solutions_alphabetized.txt">helpfully uploaded it</a>. We&rsquo;ll need to download it locally
first:
</p>

<div class="org-src-container">
<pre class="src src-shell">wget <span style="color: #98be65;">\</span>
    --output-document <span style="color: #98be65;">"src/literate_wordle/assets/wordle_answers_dict.txt"</span> <span style="color: #98be65;">\</span>
    <span style="color: #98be65;">"https://raw.githubusercontent.com/AllValley/WordleDictionary/6f14d2f03d01c36fe66e3ccc0929394251ab139d/wordle_solutions_alphabetized.txt"</span>
</pre>
</div>

<p>
Except an alphabetically sorted text file takes a lot of space but compresses
really well: let&rsquo;s compress that instead
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #dcaeea;">ANSWERS_FILE</span>=<span style="color: #98be65;">"src/literate_wordle/assets/wordle_answers_dict.txt"</span>
du -k <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">{ANSWERS_FILE}</span><span style="color: #98be65;">"</span>
gzip <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">ANSWERS_FILE</span><span style="color: #98be65;">"</span>
du -k <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">{ANSWERS_FILE}</span><span style="color: #98be65;">.gz"</span>
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">Unnecessary: gzip removes the original as it compresses</span>
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">rm</span><span style="color: #5B6268;"> "$ANSWERS_FILE"</span>
</pre>
</div>

<pre class="example">
16	src/literate_wordle/assets/wordle_answers_dict.txt
8	src/literate_wordle/assets/wordle_answers_dict.txt.gz
</pre>


<p>
Sweet, we have cut down the filesize by half.
</p>

<p>
Now, let&rsquo;s use Test-Driven Development to guide us towards picking an answer
word.
</p>
</div>
</div>

<div id="outline-container-org1a362bc" class="outline-3">
<h3 id="org1a362bc"><span class="section-number-3">1.2.</span> TDD for picking word functionality</h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #83898d;">"""Validates the Gherkin file features/pick_answer_word.feature:</span>

<span style="color: #83898d;">Feature: Pick an answer word</span>
<span style="color: #83898d;">  As a Wordle game</span>
<span style="color: #83898d;">  I need to pick a random 5 letter word</span>
<span style="color: #83898d;">  In order to let players guess it</span>
<span style="color: #83898d;">"""</span>

<span style="color: #51afef;">from</span> literate_wordle.words <span style="color: #51afef;">import</span> pick_answer_word


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_pick_word_ok_length</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Confirm a wordle solution is of right size"""</span>
    <span style="color: #51afef;">assert</span> <span style="color: #c678dd;">len</span><span style="color: #FF8811;">(</span>pick_answer_word<span style="color: #8F0;">()</span><span style="color: #FF8811;">)</span> == <span style="color: #da8548; font-weight: bold;">5</span>, <span style="color: #98be65;">"Picked wordle solution is wrong size!"</span>
</pre>
</div>

<p>
Of course, since that feature isn&rsquo;t implemented (not even the skeleton), running
tests right now would crash, not just give a red light. So let&rsquo;s implement the
barest hint of a function that returns the wrong thing, to make the test run but
fail:
</p>

<p>
First, the docstring for a new python module <code>words.py</code>
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #83898d;">"""Dictionary features to back wordle solutions"""</span>
</pre>
</div>

<p>
In that module, let&rsquo;s add the skeleton for our <code>pick_answer_word</code> function, but
return an invalid result, to make test explicitly fail:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">pick_answer_word</span><span style="color: #FF8811;">()</span> -&gt; <span style="color: #c678dd;">str</span>:
    <span style="color: #83898d;">"""Pick a Wordle solution/answer from wordle dictionary"""</span>
    <span style="color: #51afef;">return</span> <span style="color: #98be65;">""</span>  <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Incorrect solution to get RED test</span>
</pre>
</div>

<p>
With our test ready, and a dummy function in place, let&rsquo;s see the tests go red:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 2: </span>Running the tests. Note the redirection of errors to make them register and visible in my notes</label><pre class="src src-shell"><span style="color: #ECBE7B;">make</span> test <span style="color: #da8548; font-weight: bold;">2</span>&gt;&amp;<span style="color: #da8548; font-weight: bold;">1</span> || true
</pre>
</div>

<pre class="example" id="org62335ad">
poetry run pytest
============================= test session starts ==============================
platform linux -- Python 3.9.5, pytest-6.2.5, py-1.11.0, pluggy-1.0.0 -- /home/jiby/dev/ws/short/literate_wordle/.venv/bin/python
cachedir: .pytest_cache
rootdir: /home/jiby/dev/ws/short/literate_wordle, configfile: pyproject.toml
plugins: cov-3.0.0, datadir-1.3.1, clarity-1.0.1
collecting ... collected 2 items

tests/test_pick_word.py::test_pick_word_ok_length FAILED                 [ 50%]
tests/test_version.py::test_version PASSED                               [100%]

=================================== FAILURES ===================================
___________________________ test_pick_word_ok_length ___________________________

    def test_pick_word_ok_length():
        """Confirm a wordle solution is of right size"""
&gt;       assert len(pick_answer_word()) == 5, "Picked wordle solution is wrong size!"
E       AssertionError: Picked wordle solution is wrong size!
E       assert == failed. [pytest-clarity diff shown]
E
E         LHS vs RHS shown below
E
E         0
E         5
E

tests/test_pick_word.py:13: AssertionError
- generated xml file: /home/jiby/dev/ws/short/literate_wordle/test_results/results.xml -
=========================== short test summary info ============================
FAILED tests/test_pick_word.py::test_pick_word_ok_length - AssertionError: Pi...
========================= 1 failed, 1 passed in 0.07s ==========================
make: *** [Makefile:16: test] Error 1
</pre>

<p>
Tests indeed failed as expected, can now try to make it pass.
</p>
</div>
</div>

<div id="outline-container-orgda284ce" class="outline-3">
<h3 id="orgda284ce"><span class="section-number-3">1.3.</span> Importing dictionary: static/packaged asset file read</h3>
<div class="outline-text-3" id="text-1-3">
<p>
At first glance, the implementation of the function we want is simple, it looks
roughly like this:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #51afef;">with</span> <span style="color: #c678dd;">open</span><span style="color: #FF8811;">(</span><span style="color: #98be65;">"my_dictionary.txt"</span>, <span style="color: #98be65;">"r"</span><span style="color: #FF8811;">)</span> <span style="color: #51afef;">as</span> fd:
    <span style="color: #dcaeea;">my_text</span> = fd.read<span style="color: #FF8811;">()</span>
</pre>
</div>

<p>
One just needs to find the right file path and we&rsquo;re done, just add sprinkles to
deal with compression. Sure enough, that is fairly easy.
</p>

<p>
The issue is that we&rsquo;re trying to write a python package here, which means it could
be downloaded via <code>pip install</code> and installed in an arbitary location on
someone&rsquo;s computer , so our code needs to say &ldquo;the file that is in my package
alongside me&rdquo;, which is a little more complex.
</p>

<p>
From <a href="https://stackoverflow.com/a/20885799">Stackoverflow on reading static files from inside Python package</a>, we can
use the <code>importlib.resources</code> module, since our project requires <code>Python &gt;3.9</code>.
</p>

<p>
So let&rsquo;s define first a <code>get_words_list</code> function to wrap around the import
weirdness:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #83898d;">"""Dictionary features to back wordle solutions"""</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 3: </span>Necessary standard library imports</label><pre class="src src-python" id="org4deacbb"><span style="color: #51afef;">import</span> gzip
<span style="color: #51afef;">import</span> importlib.resources <span style="color: #51afef;">as</span> pkg_resources
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python" id="orgc9a2d5c"><span style="color: #51afef;">from</span> random <span style="color: #51afef;">import</span> choice
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 4: </span>Local import of <code>assets/</code> folder</label><pre class="src src-python" id="org2d29861"><span style="color: #51afef;">from</span> . <span style="color: #51afef;">import</span> assets  <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Relative import of the assets/ folder</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 5: </span>Actual function to unzip dictionary</label><pre class="src src-python" id="orgbe40d70"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">get_words_list</span><span style="color: #FF8811;">()</span> -&gt; <span style="color: #c678dd;">list</span><span style="color: #FF8811;">[</span><span style="color: #c678dd;">str</span><span style="color: #FF8811;">]</span>:
    <span style="color: #83898d;">"""Decompress the wordle dictionary"""</span>
    <span style="color: #dcaeea;">dict_compressed_bytes</span> = pkg_resources.read_binary<span style="color: #FF8811;">(</span>
        assets, <span style="color: #98be65;">"wordle_answers_dict.txt.gz"</span>
    <span style="color: #FF8811;">)</span>
    <span style="color: #dcaeea;">dict_string</span> = gzip.decompress<span style="color: #FF8811;">(</span>dict_compressed_bytes<span style="color: #FF8811;">)</span>.decode<span style="color: #FF8811;">(</span><span style="color: #98be65;">"ascii"</span><span style="color: #FF8811;">)</span>
    <span style="color: #dcaeea;">answer_word_list</span> = <span style="color: #FF8811;">[</span>word.strip<span style="color: #8F0;">()</span>.lower<span style="color: #8F0;">()</span> <span style="color: #51afef;">for</span> word <span style="color: #51afef;">in</span> dict_string.split<span style="color: #8F0;">(</span><span style="color: #98be65;">"\n"</span><span style="color: #8F0;">)</span><span style="color: #FF8811;">]</span>
    <span style="color: #51afef;">return</span> answer_word_list
</pre>
</div>

<p>
Then write out the pretty trivial function to pick:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 6: </span>Pick-a-word!</label><pre class="src src-python" id="orga94302e"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">pick_answer_word</span><span style="color: #FF8811;">()</span> -&gt; <span style="color: #c678dd;">str</span>:
    <span style="color: #83898d;">"""Pick a single word out of the dictionary of answers"""</span>
    <span style="color: #51afef;">return</span> choice<span style="color: #FF8811;">(</span>get_words_list<span style="color: #8F0;">()</span><span style="color: #FF8811;">)</span>
</pre>
</div>

<p>
And make the <code>assets/</code> folder a proper importable python module just to be sure
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #ECBE7B;">echo</span> <span style="color: #98be65;">'"""Static binary assets required to Wordle well"""'</span> &gt; src/literate_wordle/assets/__init__.py
</pre>
</div>

<p>
&#x2026; So now we have an implementation of the function, let&rsquo;s manually test it in
a Python REPL:
</p>

<div class="org-src-container">
<pre class="src src-shell">poetry run python3 -c <span style="color: #98be65;">'from literate_wordle import words; print(words.pick_answer_word()); print(words.pick_answer_word())'</span>
</pre>
</div>

<pre class="example">
stink
blank
</pre>


<p>
Perfect! So the test should now pass, right?
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #ECBE7B;">make</span>
</pre>
</div>

<pre class="example" id="orgad42653">
poetry install
Installing dependencies from lock file

No dependencies to install or update

Installing the current project: literate_wordle (0.1.0)
pre-commit run --all --all-files
Emacs tangle org-mode literate-programming files (ensures synced).......................Passed
Emacs export org-mode file to static HTML...............................................Passed
Trim Trailing Whitespace................................................................Passed
Fix End of Files........................................................................Passed
Check for added large files.............................................................Passed
Check that executables have shebangs................................(no files to check)Skipped
Check for case conflicts................................................................Passed
Check vcs permalinks....................................................................Passed
Forbid new submodules...................................................................Passed
Mixed line ending.......................................................................Passed
Check for merge conflicts...............................................................Passed
Detect Private Key......................................................................Passed
Check Toml..............................................................................Passed
Check Yaml..............................................................................Passed
Check JSON..........................................................(no files to check)Skipped
mypy....................................................................................Passed
cd docs &amp;&amp; make html
make[1]: Entering directory '/home/jiby/dev/ws/short/literate_wordle/docs'
Running Sphinx v4.4.0
Read in collections ...
  wordle_html_export_filecopy: Initialised
  gherkin_features_foldercopy: Initialised
  gherkin_features_jinja: Initialised
Clean collections ...
  gherkin_features_foldercopy: (CopyFolderDriver) Folder deleted: /home/jiby/dev/ws/short/literate_wordle/docs/source/_collections/gherkin_features/
  gherkin_features_jinja: (JinjaDriver) Cleaning 1 jinja Based file/s ...
Executing collections ...
  wordle_html_export_filecopy: (CopyFileDriver) Copy file...
  gherkin_features_foldercopy: (CopyFolderDriver) Copy folder...
  gherkin_features_jinja: (JinjaDriver) Creating 1 file/s from Jinja template...
loading pickled environment... done
[autosummary] generating autosummary for: _collections/gherkin_feature.md, index.rst, readme.md, wordle.md
[AutoAPI] Reading files... [ 33%] /home/jiby/dev/ws/short/literate_wordle/src/literate_wordle/__init__.py
[AutoAPI] Reading files... [ 66%] /home/jiby/dev/ws/short/literate_wordle/src/literate_wordle/words.py
[AutoAPI] Reading files... [100%] /home/jiby/dev/ws/short/literate_wordle/src/literate_wordle/assets/__init__.py

[AutoAPI] Mapping Data... [ 33%] /home/jiby/dev/ws/short/literate_wordle/src/literate_wordle/__init__.py
[AutoAPI] Mapping Data... [ 66%] /home/jiby/dev/ws/short/literate_wordle/src/literate_wordle/words.py
[AutoAPI] Mapping Data... [100%] /home/jiby/dev/ws/short/literate_wordle/src/literate_wordle/assets/__init__.py

[AutoAPI] Rendering Data... [ 33%] literate_wordle
[AutoAPI] Rendering Data... [ 66%] literate_wordle.words
[AutoAPI] Rendering Data... [100%] literate_wordle.assets

myst v0.15.2: MdParserConfig(renderer='sphinx', commonmark_only=False, enable_extensions=['dollarmath'], dmath_allow_labels=True, dmath_allow_space=True, dmath_allow_digits=True, dmath_double_inline=False, update_mathjax=True, mathjax_classes='tex2jax_process|mathjax_process|math|output_area', disable_syntax=[], url_schemes=['http', 'https', 'mailto', 'ftp'], heading_anchors=2, heading_slug_func=None, html_meta=[], footnote_transition=True, substitutions=[], sub_delimiters=['{', '}'], words_per_minute=200)
building [mo]: targets for 0 po files that are out of date
building [html]: targets for 5 source files that are out of date
updating environment: 0 added, 6 changed, 1 removed
reading sources... [ 16%] _collections/gherkin_feature
reading sources... [ 33%] autoapi/index
reading sources... [ 50%] autoapi/literate_wordle/assets/index
reading sources... [ 66%] autoapi/literate_wordle/index
reading sources... [ 83%] autoapi/literate_wordle/words/index
reading sources... [100%] wordle

Copying static files for sphinx-needs datatables support.../home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/datatables_loader.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/datatables.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/sphinx_needs_collapse.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/datatables.min.css /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/JSZip-2.5.0/jszip.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Buttons-1.5.1/js/buttons.print.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Buttons-1.5.1/js/buttons.flash.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Buttons-1.5.1/js/buttons.html5.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Buttons-1.5.1/js/buttons.colVis.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Buttons-1.5.1/js/dataTables.buttons.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Buttons-1.5.1/js/buttons.html5.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Buttons-1.5.1/css/common.scss /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Buttons-1.5.1/css/mixins.scss /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Buttons-1.5.1/css/buttons.dataTables.min.css /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Buttons-1.5.1/swf/flashExport.swf /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/DataTables-1.10.16/js/jquery.dataTables.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/DataTables-1.10.16/css/jquery.dataTables.min.css /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/DataTables-1.10.16/images/sort_asc.png /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/DataTables-1.10.16/images/sort_desc_disabled.png /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/DataTables-1.10.16/images/sort_asc_disabled.png /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/DataTables-1.10.16/images/sort_both.png /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/DataTables-1.10.16/images/sort_desc.png /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/ColReorder-1.4.1/js/dataTables.colReorder.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/ColReorder-1.4.1/css/colReorder.dataTables.min.css /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/FixedColumns-3.2.4/js/dataTables.fixedColumns.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/FixedColumns-3.2.4/css/fixedColumns.dataTables.min.css /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Scroller-1.4.4/js/dataTables.scroller.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Scroller-1.4.4/css/scroller.dataTables.min.css /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/FixedHeader-3.1.3/js/dataTables.fixedHeader.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/FixedHeader-3.1.3/css/fixedHeader.dataTables.min.css /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Responsive-2.2.1/js/dataTables.responsive.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Responsive-2.2.1/css/responsive.dataTables.min.css /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/pdfmake-0.1.32/pdfmake.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/pdfmake-0.1.32/vfs_fonts.js
Copying static files for sphinx-needs custom style support...[ 25%] common.css
Copying static files for sphinx-needs custom style support...[ 50%] /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/css/modern/layouts.css
Copying static files for sphinx-needs custom style support...[ 75%] /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/css/modern/styles.css
Copying static files for sphinx-needs custom style support...[100%] /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/css/modern/modern.css

looking for now-outdated files... none found
pickling environment... done
checking consistency... done
preparing documents... done
writing output... [ 14%] _collections/gherkin_feature
writing output... [ 28%] autoapi/index
writing output... [ 42%] autoapi/literate_wordle/assets/index
writing output... [ 57%] autoapi/literate_wordle/index
writing output... [ 71%] autoapi/literate_wordle/words/index
writing output... [ 85%] index
writing output... [100%] wordle

generating indices... genindex py-modindex done
highlighting module code... [ 50%] literate_wordle
highlighting module code... [100%] literate_wordle.words

writing additional pages... search done
copying images... [ 50%] /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/images/feather_svg/arrow-down-circle.svg
copying images... [100%] /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/images/feather_svg/arrow-right-circle.svg

copying static files... done
copying extra files... done
dumping search index in English (code: en)... done
dumping object inventory... done
build succeeded, 2 warnings.

The HTML pages are in build/html.
Final clean of collections ...
  wordle_html_export_filecopy: (CopyFileDriver) File deleted: /home/jiby/dev/ws/short/literate_wordle/docs/source/_collections/_static/wordle.html
  gherkin_features_foldercopy: (CopyFolderDriver) Folder deleted: /home/jiby/dev/ws/short/literate_wordle/docs/source/_collections/gherkin_features/
  gherkin_features_jinja: (JinjaDriver) Cleaning 1 jinja Based file/s ...
  gherkin_features_jinja: (JinjaDriver)   File deleted: /home/jiby/dev/ws/short/literate_wordle/docs/source/_collections/gherkin_feature.md

Checking sphinx-needs warnings
make[1]: Leaving directory '/home/jiby/dev/ws/short/literate_wordle/docs'
poetry run pytest
============================= test session starts ==============================
platform linux -- Python 3.9.5, pytest-6.2.5, py-1.11.0, pluggy-1.0.0 -- /home/jiby/dev/ws/short/literate_wordle/.venv/bin/python
cachedir: .pytest_cache
rootdir: /home/jiby/dev/ws/short/literate_wordle, configfile: pyproject.toml
plugins: cov-3.0.0, datadir-1.3.1, clarity-1.0.1
collecting ... collected 2 items

tests/test_pick_word.py::test_pick_word_ok_length PASSED                 [ 50%]
tests/test_version.py::test_version PASSED                               [100%]

- generated xml file: /home/jiby/dev/ws/short/literate_wordle/test_results/results.xml -
============================== 2 passed in 0.03s ===============================
poetry build
Building literate_wordle (0.1.0)
  - Building sdist
  - Built literate_wordle-0.1.0.tar.gz
  - Building wheel
  - Built literate_wordle-0.1.0-py3-none-any.whl
</pre>

<p>
Everything checks out: our feature is ready!<sup><a id="fnr.1" class="footref" href="#fn.1" role="doc-backlink">1</a></sup>
</p>
</div>
</div>
<div id="outline-container-org30c8928" class="outline-3">
<h3 id="org30c8928"><span class="section-number-3">1.4.</span> Debriefing on the method</h3>
<div class="outline-text-3" id="text-1-4">
<p>
We just completed our first loop: determine a small component that needs
implemented to build towards Wordle goal, spell it out with Gherkin features,
explicit the feature via tests, and iterate on the new RED test until it becomes
green.<sup><a id="fnr.2" class="footref" href="#fn.2" role="doc-backlink">2</a></sup>
</p>

<p>
Along the way, the code spelled out in this narrative-oriented file is tangled
out into proper code paths, so that the <code>Makefile</code> can pick it up and validate
the proper package-ness.
</p>
</div>
</div>
</div>
<div id="outline-container-org9a36b59" class="outline-2">
<h2 id="org9a36b59"><span class="section-number-2">2.</span> Confirming guess is a valid word</h2>
<div class="outline-text-2" id="text-2">
<p>
Now that we can pick secret words, we need to start processing guesses. The very
first thing a guess needs is validating guesses are proper words of the right
length. This feature will give us a familiar context (dictionaries), while
slowly ramping up the details of the Gherkin features:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 7: </span>New Gherkin feature file <code>features/checking_guess_valid_word.feature</code></label><pre class="src src-feature" id="org001169c"><span style="color: #51afef;">Feature:</span><span style="color: #ECBE7B;"> Checking a guess is a valid word</span>
  As a Wordle game
  I need to confirm each guessed word is valid
  So that I only accept real words, no kwyjibo
</pre>
</div>

<p>
In practice, this means multiple things:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 8: </span>Scenarios to describe the feature in details</label><pre class="src src-feature" id="orgde9d675"><span style="color: #51afef;">Scenario:</span><span style="color: #c678dd;"> Reject long words</span>
<span style="color: #51afef;">  When</span> guessing <span style="color: #98be65;">"affable"</span>
<span style="color: #51afef;">  Then</span> the guess is rejected
<span style="color: #51afef;">  And</span> reason for rejection is <span style="color: #98be65;">"Guess too long"</span>

<span style="color: #51afef;">Scenario:</span><span style="color: #c678dd;"> Reject short words</span>
<span style="color: #51afef;">  When</span> guessing <span style="color: #98be65;">"baby"</span>
<span style="color: #51afef;">  Then</span> the guess is rejected
<span style="color: #51afef;">  And</span> reason for rejection is <span style="color: #98be65;">"Guess too short"</span>

<span style="color: #51afef;">Scenario:</span><span style="color: #c678dd;"> Reject fake words via dictionary</span>
<span style="color: #51afef;">  When</span> guessing <span style="color: #98be65;">"vbpdj"</span>
<span style="color: #51afef;">  Then</span> the guess is rejected
<span style="color: #51afef;">  And</span> reason for rejection is <span style="color: #98be65;">"Not a word from the dictionary"</span>

<span style="color: #51afef;">Scenario:</span><span style="color: #c678dd;"> Accept five letter dictionary words</span>
<span style="color: #51afef;">  When</span> guessing <span style="color: #98be65;">"crane"</span>
<span style="color: #51afef;">  Then</span> the guess is accepted
</pre>
</div>

<p>
So, with a feature covering two scenarios, we can start laying out acceptance
tests.
</p>

<p>
Since I quite like to use the Gherkin feature file inside the
docstrings of Python tests, I&rsquo;m going to take advantage of having already
written it above to reference it for export, so I can template it out:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 9: </span>New test file&rsquo;s module-level docstring, using (invisible during rendering) templating to fill in the gherkin feature from Listing <a href="#org001169c">7</a></label><pre class="src src-python" id="orgdf61801"><span style="color: #83898d;">"""Validates the Gherkin file features/checking_guess_valid_word.feature:</span>

<span style="color: #83898d;">Feature: Checking a guess is a valid word</span>
<span style="color: #83898d;">  As a Wordle game</span>
<span style="color: #83898d;">  I need to confirm each guessed word is valid</span>
<span style="color: #83898d;">  So that I only accept real words, no kwyjibo</span>
<span style="color: #83898d;">"""</span>
</pre>
</div>

<p>
Just this once, I&rsquo;ll show how the templating happens behind the scene:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 10: </span>Same code block as Listing <a href="#orgdf61801">9</a>, but without the magic templating enabled: each block with two chevrons around references a code block from above.</label><pre class="src src-python" id="org411ae1f"><span style="color: #83898d;">"""Validates the Gherkin file features/checking_guess_valid_word.feature:</span>

<span style="color: #83898d;">&lt;&lt;feature-check-valid-guess&gt;&gt;</span>

<span style="color: #83898d;">&lt;&lt;scenario-check-valid-guess&gt;&gt;</span>
<span style="color: #83898d;">"""</span>
</pre>
</div>
</div>
<div id="outline-container-orgaf7e508" class="outline-3">
<h3 id="orgaf7e508"><span class="section-number-3">2.1.</span> Test setup</h3>
<div class="outline-text-3" id="text-2-1">
<p>
With the feature described, let&rsquo;s import our hypothetical test code
</p>

<div class="org-src-container">
<pre class="src src-python" id="orgdd66152"><span style="color: #51afef;">from</span> literate_wordle.words <span style="color: #51afef;">import</span> check_valid_word
</pre>
</div>

<p>
And write out a simple test using the first scenario:
</p>

<div class="org-src-container">
<pre class="src src-python" id="org371cef0"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_reject_long_words</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: Reject long words"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When guessing "affable"</span>
    <span style="color: #dcaeea;">guess</span> = <span style="color: #98be65;">"affable"</span>
    <span style="color: #dcaeea;">is_valid</span>, <span style="color: #dcaeea;">reject_reason</span> = check_valid_word<span style="color: #FF8811;">(</span>guess<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then the guess is rejected</span>
    <span style="color: #51afef;">assert</span> <span style="color: #51afef;">not</span> is_valid, <span style="color: #98be65;">"Overly long guess should have been rejected"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And reason for rejection is "Guess too long"</span>
    <span style="color: #51afef;">assert</span> reject_reason == <span style="color: #98be65;">"Guess too long"</span>
</pre>
</div>

<p>
And in a similar way, we write the opposite test for too short:
</p>

<div class="org-src-container">
<pre class="src src-python" id="org8038b33"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_reject_overly_short_words</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: Reject short words"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When guessing "baby"</span>
    <span style="color: #dcaeea;">guess</span> = <span style="color: #98be65;">"baby"</span>
    <span style="color: #dcaeea;">is_valid</span>, <span style="color: #dcaeea;">reject_reason</span> = check_valid_word<span style="color: #FF8811;">(</span>guess<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then the guess is rejected</span>
    <span style="color: #51afef;">assert</span> <span style="color: #51afef;">not</span> is_valid, <span style="color: #98be65;">"Overly short guess should have been rejected"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And reason for rejection is "Guess too short"</span>
    <span style="color: #51afef;">assert</span> reject_reason == <span style="color: #98be65;">"Guess too short"</span>
</pre>
</div>

<p>
And finally, the dictionary checks:
</p>

<div class="org-src-container">
<pre class="src src-python" id="org044f211"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_reject_nondict_words</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: Reject fake words via dictionary"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When guessing "vbpdj"</span>
    <span style="color: #dcaeea;">guess</span> = <span style="color: #98be65;">"vbpdj"</span>
    <span style="color: #dcaeea;">is_valid</span>, <span style="color: #dcaeea;">reject_reason</span> = check_valid_word<span style="color: #FF8811;">(</span>guess<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then the guess is rejected</span>
    <span style="color: #51afef;">assert</span> <span style="color: #51afef;">not</span> is_valid, <span style="color: #98be65;">"Word not in dictionary should have been rejected"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And reason for rejection is "Not a word from the dictionary"</span>
    <span style="color: #51afef;">assert</span> reject_reason == <span style="color: #98be65;">"Not a word from the dictionary"</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python" id="org9ad10ce"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_accept_dict_words</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: Accept five letter dictionary words"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When guessing "crane"</span>
    <span style="color: #dcaeea;">guess</span> = <span style="color: #98be65;">"crane"</span>
    <span style="color: #dcaeea;">is_valid</span>, <span style="color: #dcaeea;">reject_reason</span> = check_valid_word<span style="color: #FF8811;">(</span>guess<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then the guess is accepted</span>
    <span style="color: #51afef;">assert</span> is_valid, <span style="color: #98be65;">"Correct length word in dictionary should have been accepted"</span>
</pre>
</div>

<p>
One tiny detail regarding this last example, which highlights why separating
Gherkin from actual code is important: We describe in the positive scenario the
need to accept a correct word in terms of &ldquo;not rejecting&rdquo;, which in code maps to
the <code>is_valid</code> boolean. That&rsquo;s suffficient to make the Gherkin scenario, which
is what we think of when designing the software, but as we see in the
implementation, there&rsquo;s also the matter of the <code>reject_reason</code> component, which
we should check for emptiness. That is an implementation detail, which has no
reason to be laid out in the original scenario, but is still valid to make
assertions on. So we shall:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 11: </span>This line isn&rsquo;t defined in Gherkin, because it separates the implementation from the feature&rsquo;s requirement</label><pre class="src src-python" id="org4aacd63">    <span style="color: #51afef;">assert</span> reject_reason <span style="color: #51afef;">is</span> <span style="color: #a9a1e1;">None</span>, <span style="color: #98be65;">"Accepted word should have no reason to be rejected"</span>
</pre>
</div>

<p>
With all these (high level) tests in hand, let&rsquo;s write up some small
implementation to get RED tests instead of a crash.
</p>

<p>
First up is defining a signature: We take a guess in, and return a boolean and a
string. Except sometimes (as seen in Listing <a href="#org4aacd63">11</a>) it&rsquo;s
<code>None</code>, so that&rsquo;s more of an <code>Optional</code> string, which we&rsquo;ll need to import:
</p>

<div class="org-src-container">
<pre class="src src-python" id="org6bbce14"><span style="color: #51afef;">from</span> typing <span style="color: #51afef;">import</span> Optional, Tuple
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org3b62443"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">check_valid_word</span><span style="color: #FF8811;">(</span>guess: <span style="color: #c678dd;">str</span><span style="color: #FF8811;">)</span> -&gt; Tuple<span style="color: #FF8811;">[</span><span style="color: #c678dd;">bool</span>, Optional<span style="color: #8F0;">[</span><span style="color: #c678dd;">str</span><span style="color: #8F0;">]</span><span style="color: #FF8811;">]</span>:
</pre>
</div>

<p>
And to fill it with junk:
</p>

<div class="org-src-container">
<pre class="src src-python" id="orge4d4f1e">    <span style="color: #98be65;">"""Implement fake checking a valid word"""</span>
    <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">False</span>, <span style="color: #98be65;">"Not implemented"</span>
</pre>
</div>

<p>
All right, so we have tests, let&rsquo;s see them fail!
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #ECBE7B;">make</span> test <span style="color: #da8548; font-weight: bold;">2</span>&gt;&amp;<span style="color: #da8548; font-weight: bold;">1</span> || true
</pre>
</div>

<pre class="example" id="org835f282">
poetry run pytest
============================= test session starts ==============================
platform linux -- Python 3.9.5, pytest-6.2.5, py-1.11.0, pluggy-1.0.0 -- /home/jiby/dev/ws/short/literate_wordle/.venv/bin/python
cachedir: .pytest_cache
rootdir: /home/jiby/dev/ws/short/literate_wordle, configfile: pyproject.toml
plugins: cov-3.0.0, clarity-1.0.1
collecting ... collected 5 items

tests/test_checking_guess_valid_word.py::test_reject_long_words FAILED   [ 20%]
tests/test_checking_guess_valid_word.py::test_reject_overly_short_words FAILED [ 40%]
tests/test_checking_guess_valid_word.py::test_reject_nondict_words FAILED [ 60%]
tests/test_checking_guess_valid_word.py::test_accept_dict_words FAILED   [ 80%]
tests/test_pick_word.py::test_pick_word_ok_length PASSED                 [100%]

=================================== FAILURES ===================================
____________________________ test_reject_long_words ____________________________

    def test_reject_long_words():
        """Scenario: Reject long words"""
        # When guessing "affable"
        guess = "affable"
        is_valid, reject_reason = check_valid_word(guess)
        # Then the guess is rejected
        assert not is_valid, "Overly long guess should have been rejected"
        # And reason for rejection is "Guess too long"
&gt;       assert reject_reason == "Guess too long"
E       assert == failed. [pytest-clarity diff shown]
E
E         LHS vs RHS shown below
E
E         Not implemented
E         Guess too long
E

tests/test_checking_guess_valid_word.py:39: AssertionError
________________________ test_reject_overly_short_words ________________________

    def test_reject_overly_short_words():
        """Scenario: Reject short words"""
        # When guessing "baby"
        guess = "baby"
        is_valid, reject_reason = check_valid_word(guess)
        # Then the guess is rejected
        assert not is_valid, "Overly short guess should have been rejected"
        # And reason for rejection is "Guess too short"
&gt;       assert reject_reason == "Guess too short"
E       assert == failed. [pytest-clarity diff shown]
E
E         LHS vs RHS shown below
E
E         Not implemented
E         Guess too short
E

tests/test_checking_guess_valid_word.py:50: AssertionError
__________________________ test_reject_nondict_words ___________________________

    def test_reject_nondict_words():
        """Scenario: Reject fake words via dictionary"""
        # When guessing "vbpdj"
        guess = "vbpdj"
        is_valid, reject_reason = check_valid_word(guess)
        # Then the guess is rejected
        assert not is_valid, "Word not in dictionary should have been rejected"
        # And reason for rejection is "Not a word from the dictionary"
&gt;       assert reject_reason == "Not a word from the dictionary"
E       assert == failed. [pytest-clarity diff shown]
E
E         LHS vs RHS shown below
E
E         Not implemented
E         Not a word from the dictionary
E

tests/test_checking_guess_valid_word.py:61: AssertionError
____________________________ test_accept_dict_words ____________________________

    def test_accept_dict_words():
        """Scenario: Accept five letter dictionary words"""
        # When guessing "crane"
        guess = "crane"
        is_valid, reject_reason = check_valid_word(guess)
        # Then the guess is accepted
&gt;       assert is_valid, "Correct length word in dictionary should have been accepted"
E       AssertionError: Correct length word in dictionary should have been accepted
E       assert False

tests/test_checking_guess_valid_word.py:70: AssertionError
- generated xml file: /home/jiby/dev/ws/short/literate_wordle/test_results/results.xml -

----------- coverage: platform linux, python 3.9.5-final-0 -----------
Name                                     Stmts   Miss  Cover
------------------------------------------------------------
src/literate_wordle/__init__.py              1      0   100%
src/literate_wordle/assets/__init__.py       0      0   100%
src/literate_wordle/words.py                14      0   100%
------------------------------------------------------------
TOTAL                                       15      0   100%
Coverage HTML written to dir test_results/coverage.html
Coverage XML written to file test_results/coverage.xml

=========================== short test summary info ============================
FAILED tests/test_checking_guess_valid_word.py::test_reject_long_words - asse...
FAILED tests/test_checking_guess_valid_word.py::test_reject_overly_short_words
FAILED tests/test_checking_guess_valid_word.py::test_reject_nondict_words - a...
FAILED tests/test_checking_guess_valid_word.py::test_accept_dict_words - Asse...
========================= 4 failed, 1 passed in 0.13s ==========================
make: *** [Makefile:16: test] Error 1
</pre>

<p>
Test failure as expected, and enjoy that 100% coverage!<sup><a id="fnr.3" class="footref" href="#fn.3" role="doc-backlink">3</a></sup>
</p>
</div>
</div>

<div id="outline-container-org335116f" class="outline-3">
<h3 id="org335116f"><span class="section-number-3">2.2.</span> Implementing the feature, one test at a time</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Let&rsquo;s implement the proper feature. First, we fill a dummy function body to
check length, and test it out, seeing less tests fail as we implemented half the
feature:
</p>

<div class="org-src-container">
<pre class="src src-python" id="org60e61e5"><span style="color: #83898d;">"""Check wordle guess length only, no dict checks"""</span>
<span style="color: #dcaeea;">answer_length</span> = <span style="color: #da8548; font-weight: bold;">5</span>
<span style="color: #dcaeea;">guess_length</span> = <span style="color: #c678dd;">len</span><span style="color: #FF8811;">(</span>guess<span style="color: #FF8811;">)</span>
<span style="color: #51afef;">if</span> guess_length &lt; answer_length:
    <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">False</span>, <span style="color: #98be65;">"Guess too short"</span>
<span style="color: #51afef;">elif</span> guess_length &gt; answer_length:
    <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">False</span>, <span style="color: #98be65;">"Guess too long"</span>
<span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">True</span>, <span style="color: #a9a1e1;">None</span>  <span style="color: #5B6268;"># </span><span style="color: #5B6268;">No dictionary check</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #ECBE7B;">make</span> test <span style="color: #da8548; font-weight: bold;">2</span>&gt;&amp;<span style="color: #da8548; font-weight: bold;">1</span> || true
</pre>
</div>

<pre class="example" id="org55dcad1">
poetry run pytest
============================= test session starts ==============================
platform linux -- Python 3.9.5, pytest-6.2.5, py-1.11.0, pluggy-1.0.0 -- /home/jiby/dev/ws/short/literate_wordle/.venv/bin/python
cachedir: .pytest_cache
rootdir: /home/jiby/dev/ws/short/literate_wordle, configfile: pyproject.toml
plugins: cov-3.0.0, clarity-1.0.1
collecting ... collected 5 items

tests/test_checking_guess_valid_word.py::test_reject_long_words PASSED   [ 20%]
tests/test_checking_guess_valid_word.py::test_reject_overly_short_words PASSED [ 40%]
tests/test_checking_guess_valid_word.py::test_reject_nondict_words FAILED [ 60%]
tests/test_checking_guess_valid_word.py::test_accept_dict_words PASSED   [ 80%]
tests/test_pick_word.py::test_pick_word_ok_length PASSED                 [100%]

=================================== FAILURES ===================================
__________________________ test_reject_nondict_words ___________________________

    def test_reject_nondict_words():
        """Scenario: Reject fake words via dictionary"""
        # When guessing "vbpdj"
        guess = "vbpdj"
        is_valid, reject_reason = check_valid_word(guess)
        # Then the guess is rejected
&gt;       assert not is_valid, "Word not in dictionary should have been rejected"
E       AssertionError: Word not in dictionary should have been rejected
E       assert not True

tests/test_checking_guess_valid_word.py:59: AssertionError
- generated xml file: /home/jiby/dev/ws/short/literate_wordle/test_results/results.xml -

----------- coverage: platform linux, python 3.9.5-final-0 -----------
Name                                     Stmts   Miss  Cover
------------------------------------------------------------
src/literate_wordle/__init__.py              1      0   100%
src/literate_wordle/assets/__init__.py       0      0   100%
src/literate_wordle/words.py                19      0   100%
------------------------------------------------------------
TOTAL                                       20      0   100%
Coverage HTML written to dir test_results/coverage.html
Coverage XML written to file test_results/coverage.xml

=========================== short test summary info ============================
FAILED tests/test_checking_guess_valid_word.py::test_reject_nondict_words - A...
========================= 1 failed, 4 passed in 0.11s ==========================
make: *** [Makefile:16: test] Error 1
</pre>

<p>
Progress! Four of five tests pass, so we now need the dictionary.
</p>


<p>
Note that in Wordle, the list of possible solutions is a subset of the word
dictionary used for guess validation. We previously loaded the answers, now we
need the larger set of accepted words. While it does mean there will be
duplicates, we&rsquo;re talking kilobytes, we can afford that.
</p>

<p>
We fetch the dictionary like before:
</p>

<div class="org-src-container">
<pre class="src src-shell">wget <span style="color: #98be65;">\</span>
    --output-document <span style="color: #98be65;">"src/literate_wordle/assets/wordle_accepted_words_dict.txt"</span> <span style="color: #98be65;">\</span>
    <span style="color: #98be65;">"https://raw.githubusercontent.com/AllValley/WordleDictionary/6f14d2f03d01c36fe66e3ccc0929394251ab139d/wordle_complete_dictionary.txt"</span>
</pre>
</div>

<p>
And compress it too
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #dcaeea;">ANSWERS_FILE</span>=<span style="color: #98be65;">"src/literate_wordle/assets/wordle_accepted_words_dict.txt"</span>
du -k <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">{ANSWERS_FILE}</span><span style="color: #98be65;">"</span>
gzip <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">ANSWERS_FILE</span><span style="color: #98be65;">"</span>
du -k <span style="color: #98be65;">"</span><span style="color: #a9a1e1;">$</span><span style="color: #dcaeea;">{ANSWERS_FILE}</span><span style="color: #98be65;">.gz"</span>
</pre>
</div>

<pre class="example">
92	src/literate_wordle/assets/wordle_accepted_words_dict.txt
36	src/literate_wordle/assets/wordle_accepted_words_dict.txt.gz
</pre>


<p>
This time is more like two thirds shaved off, sweet.
</p>

<p>
We reach to add a function for decompressing, but realize we mostly wrote this
before, except for the different filename. So let&rsquo;s edit the previous iteration
to be more generic. One way this can be more generic is returning a <code>set</code> of
strings, instead of the previous <code>list</code>. This means we assume no ordering and
use hash addressing, rather than strict string ordering. After all, we will not
iterate through the list, as much as we want to randomly access entries, so the
<code>set</code> will provide benefits
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 12: </span>Generic &ldquo;unzip asset&rdquo; function</label><pre class="src src-python" id="orgf4fa827"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">get_asset_zip_as_set</span><span style="color: #FF8811;">(</span>asset_filename: <span style="color: #c678dd;">str</span><span style="color: #FF8811;">)</span> -&gt; <span style="color: #c678dd;">set</span><span style="color: #FF8811;">[</span><span style="color: #c678dd;">str</span><span style="color: #FF8811;">]</span>:
    <span style="color: #83898d;">"""Decompress a file in assets module into a set of words, separated by newline"""</span>
    <span style="color: #dcaeea;">compressed_bytes</span> = pkg_resources.read_binary<span style="color: #FF8811;">(</span>assets, asset_filename<span style="color: #FF8811;">)</span>
    <span style="color: #dcaeea;">string</span> = gzip.decompress<span style="color: #FF8811;">(</span>compressed_bytes<span style="color: #FF8811;">)</span>.decode<span style="color: #FF8811;">(</span><span style="color: #98be65;">"ascii"</span><span style="color: #FF8811;">)</span>
    <span style="color: #dcaeea;">string_list</span> = <span style="color: #FF8811;">[</span>word.strip<span style="color: #8F0;">()</span>.lower<span style="color: #8F0;">()</span> <span style="color: #51afef;">for</span> word <span style="color: #51afef;">in</span> string.split<span style="color: #8F0;">(</span><span style="color: #98be65;">"\n"</span><span style="color: #8F0;">)</span><span style="color: #FF8811;">]</span>
    <span style="color: #51afef;">return</span> <span style="color: #c678dd;">set</span><span style="color: #FF8811;">(</span>string_list<span style="color: #FF8811;">)</span>
</pre>
</div>

<p>
Which changes the invocation of <code>pick_answer_word</code> into:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 13: </span>Pick-a-word, revisited to generic asset fetching</label><pre class="src src-python" id="org92e2731"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">pick_answer_word</span><span style="color: #FF8811;">()</span> -&gt; <span style="color: #c678dd;">str</span>:
    <span style="color: #83898d;">"""Pick a single word out of the dictionary of answers"""</span>
    <span style="color: #51afef;">return</span> choice<span style="color: #FF8811;">(</span><span style="color: #c678dd;">list</span><span style="color: #8F0;">(</span>get_asset_zip_as_set<span style="color: #55DDFF;">(</span><span style="color: #98be65;">"wordle_answers_dict.txt.gz"</span><span style="color: #55DDFF;">)</span><span style="color: #8F0;">)</span><span style="color: #FF8811;">)</span>
</pre>
</div>

<p>
And now we can use the dictionary as a set in our <code>check_valid_word</code> function:
</p>

<div class="org-src-container">
<pre class="src src-python" id="org44f3b8f"><span style="color: #83898d;">"""Check a wordle guess is valid: length and in dictionary"""</span>
<span style="color: #dcaeea;">answer_length</span> = <span style="color: #da8548; font-weight: bold;">5</span>
<span style="color: #dcaeea;">guess_length</span> = <span style="color: #c678dd;">len</span><span style="color: #FF8811;">(</span>guess<span style="color: #FF8811;">)</span>
<span style="color: #51afef;">if</span> guess_length &lt; answer_length:
    <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">False</span>, <span style="color: #98be65;">"Guess too short"</span>
<span style="color: #51afef;">elif</span> guess_length &gt; answer_length:
    <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">False</span>, <span style="color: #98be65;">"Guess too long"</span>
<span style="color: #dcaeea;">valid_words_dict</span> = get_asset_zip_as_set<span style="color: #FF8811;">(</span><span style="color: #98be65;">"wordle_accepted_words_dict.txt.gz"</span><span style="color: #FF8811;">)</span>
<span style="color: #51afef;">if</span> guess <span style="color: #51afef;">in</span> valid_words_dict:
    <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">True</span>, <span style="color: #a9a1e1;">None</span>
<span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">False</span>, <span style="color: #98be65;">"Not a word from the dictionary"</span>
</pre>
</div>

<p>
And we&rsquo;re done! Let&rsquo;s run our system through <code>make</code> again, to spot test failures
but also to get linters:
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #ECBE7B;">make</span>
</pre>
</div>

<pre class="example" id="org3067beb">
poetry install
Installing dependencies from lock file

No dependencies to install or update

Installing the current project: literate_wordle (0.1.0)
pre-commit run --all --all-files
Emacs export org-mode file to static HTML................................Passed
Trim Trailing Whitespace.................................................Passed
Fix End of Files.........................................................Passed
Check for added large files..............................................Passed
Check that executables have shebangs.................(no files to check)Skipped
Check for case conflicts.................................................Passed
Check vcs permalinks.....................................................Passed
Forbid new submodules....................................................Passed
Mixed line ending........................................................Passed
Check for merge conflicts................................................Passed
Detect Private Key.......................................................Passed
Check Toml...............................................................Passed
Check Yaml...............................................................Passed
Check JSON...........................................(no files to check)Skipped
black....................................................................Passed
isort (python)...........................................................Passed
mypy.....................................................................Passed
flake8...................................................................Passed
cd docs &amp;&amp; make html
make[1]: Entering directory '/home/jiby/dev/ws/short/literate_wordle/docs'
Running Sphinx v4.4.0
Read in collections ...
  wordle_html_export_filecopy: Initialised
  gherkin_features_foldercopy: Initialised
  gherkin_features_jinja: Initialised
Clean collections ...
  gherkin_features_foldercopy: (CopyFolderDriver) Folder deleted: /home/jiby/dev/ws/short/literate_wordle/docs/source/_collections/gherkin_features/
  gherkin_features_jinja: (JinjaDriver) Cleaning 1 jinja Based file/s ...
Executing collections ...
  wordle_html_export_filecopy: (CopyFileDriver) Copy file...
  gherkin_features_foldercopy: (CopyFolderDriver) Copy folder...
  gherkin_features_jinja: (JinjaDriver) Creating 1 file/s from Jinja template...
loading pickled environment... done
[autosummary] generating autosummary for: _collections/gherkin_feature.md, index.rst, readme.md, wordle.md, wordle_sources.md
[AutoAPI] Reading files... [ 33%] /home/jiby/dev/ws/short/literate_wordle/src/literate_wordle/__init__.py
[AutoAPI] Reading files... [ 66%] /home/jiby/dev/ws/short/literate_wordle/src/literate_wordle/words.py
[AutoAPI] Reading files... [100%] /home/jiby/dev/ws/short/literate_wordle/src/literate_wordle/assets/__init__.py

[AutoAPI] Mapping Data... [ 33%] /home/jiby/dev/ws/short/literate_wordle/src/literate_wordle/__init__.py
[AutoAPI] Mapping Data... [ 66%] /home/jiby/dev/ws/short/literate_wordle/src/literate_wordle/words.py
[AutoAPI] Mapping Data... [100%] /home/jiby/dev/ws/short/literate_wordle/src/literate_wordle/assets/__init__.py

[AutoAPI] Rendering Data... [ 33%] literate_wordle
[AutoAPI] Rendering Data... [ 66%] literate_wordle.words
[AutoAPI] Rendering Data... [100%] literate_wordle.assets

myst v0.15.2: MdParserConfig(renderer='sphinx', commonmark_only=False, enable_extensions=['dollarmath'], dmath_allow_labels=True, dmath_allow_space=True, dmath_allow_digits=True, dmath_double_inline=False, update_mathjax=True, mathjax_classes='tex2jax_process|mathjax_process|math|output_area', disable_syntax=[], url_schemes=['http', 'https', 'mailto', 'ftp'], heading_anchors=2, heading_slug_func=None, html_meta=[], footnote_transition=True, substitutions=[], sub_delimiters=['{', '}'], words_per_minute=200)
building [mo]: targets for 0 po files that are out of date
building [html]: targets for 5 source files that are out of date
updating environment: 0 added, 7 changed, 0 removed
reading sources... [ 14%] _collections/gherkin_feature
reading sources... [ 28%] autoapi/index
reading sources... [ 42%] autoapi/literate_wordle/assets/index
reading sources... [ 57%] autoapi/literate_wordle/index
reading sources... [ 71%] autoapi/literate_wordle/words/index
reading sources... [ 85%] wordle
reading sources... [100%] wordle_sources

Copying static files for sphinx-needs datatables support.../home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/datatables_loader.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/datatables.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/sphinx_needs_collapse.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/datatables.min.css /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/JSZip-2.5.0/jszip.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Buttons-1.5.1/js/buttons.print.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Buttons-1.5.1/js/buttons.flash.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Buttons-1.5.1/js/buttons.html5.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Buttons-1.5.1/js/buttons.colVis.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Buttons-1.5.1/js/dataTables.buttons.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Buttons-1.5.1/js/buttons.html5.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Buttons-1.5.1/css/common.scss /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Buttons-1.5.1/css/mixins.scss /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Buttons-1.5.1/css/buttons.dataTables.min.css /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Buttons-1.5.1/swf/flashExport.swf /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/DataTables-1.10.16/js/jquery.dataTables.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/DataTables-1.10.16/css/jquery.dataTables.min.css /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/DataTables-1.10.16/images/sort_asc.png /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/DataTables-1.10.16/images/sort_desc_disabled.png /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/DataTables-1.10.16/images/sort_asc_disabled.png /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/DataTables-1.10.16/images/sort_both.png /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/DataTables-1.10.16/images/sort_desc.png /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/ColReorder-1.4.1/js/dataTables.colReorder.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/ColReorder-1.4.1/css/colReorder.dataTables.min.css /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/FixedColumns-3.2.4/js/dataTables.fixedColumns.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/FixedColumns-3.2.4/css/fixedColumns.dataTables.min.css /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Scroller-1.4.4/js/dataTables.scroller.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Scroller-1.4.4/css/scroller.dataTables.min.css /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/FixedHeader-3.1.3/js/dataTables.fixedHeader.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/FixedHeader-3.1.3/css/fixedHeader.dataTables.min.css /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Responsive-2.2.1/js/dataTables.responsive.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/Responsive-2.2.1/css/responsive.dataTables.min.css /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/pdfmake-0.1.32/pdfmake.min.js /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/libs/html/pdfmake-0.1.32/vfs_fonts.js
Copying static files for sphinx-needs custom style support...[ 25%] common.css
Copying static files for sphinx-needs custom style support...[ 50%] /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/css/modern/layouts.css
Copying static files for sphinx-needs custom style support...[ 75%] /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/css/modern/styles.css
Copying static files for sphinx-needs custom style support...[100%] /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/css/modern/modern.css

looking for now-outdated files... none found
pickling environment... done
checking consistency... /home/jiby/dev/ws/short/literate_wordle/docs/source/autoapi/index.rst: WARNING: document isn't included in any toctree
done
preparing documents... done
writing output... [ 12%] _collections/gherkin_feature
writing output... [ 25%] autoapi/index
writing output... [ 37%] autoapi/literate_wordle/assets/index
writing output... [ 50%] autoapi/literate_wordle/index
writing output... [ 62%] autoapi/literate_wordle/words/index
writing output... [ 75%] index
writing output... [ 87%] wordle
writing output... [100%] wordle_sources

/home/jiby/dev/ws/short/literate_wordle/docs/source/_collections/gherkin_feature.md:34: WARNING: Any IDs not assigned for table node
generating indices... genindex py-modindex done
highlighting module code... [ 50%] literate_wordle
highlighting module code... [100%] literate_wordle.words

writing additional pages... search done
copying images... [ 50%] /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/images/feather_svg/arrow-down-circle.svg
copying images... [100%] /home/jiby/dev/ws/short/literate_wordle/.venv/lib/python3.9/site-packages/sphinxcontrib/needs/images/feather_svg/arrow-right-circle.svg

copying static files... done
copying extra files... done
dumping search index in English (code: en)... done
dumping object inventory... done
build succeeded, 2 warnings.

The HTML pages are in build/html.
Final clean of collections ...
  wordle_html_export_filecopy: (CopyFileDriver) File deleted: /home/jiby/dev/ws/short/literate_wordle/docs/source/_collections/_static/wordle.html
  gherkin_features_foldercopy: (CopyFolderDriver) Folder deleted: /home/jiby/dev/ws/short/literate_wordle/docs/source/_collections/gherkin_features/
  gherkin_features_jinja: (JinjaDriver) Cleaning 1 jinja Based file/s ...
  gherkin_features_jinja: (JinjaDriver)   File deleted: /home/jiby/dev/ws/short/literate_wordle/docs/source/_collections/gherkin_feature.md

Checking sphinx-needs warnings
make[1]: Leaving directory '/home/jiby/dev/ws/short/literate_wordle/docs'
poetry run pytest
============================= test session starts ==============================
platform linux -- Python 3.9.5, pytest-6.2.5, py-1.11.0, pluggy-1.0.0 -- /home/jiby/dev/ws/short/literate_wordle/.venv/bin/python
cachedir: .pytest_cache
rootdir: /home/jiby/dev/ws/short/literate_wordle, configfile: pyproject.toml
plugins: cov-3.0.0, clarity-1.0.1
collecting ... collected 5 items

tests/test_checking_guess_valid_word.py::test_reject_long_words PASSED   [ 20%]
tests/test_checking_guess_valid_word.py::test_reject_overly_short_words PASSED [ 40%]
tests/test_checking_guess_valid_word.py::test_reject_nondict_words PASSED [ 60%]
tests/test_checking_guess_valid_word.py::test_accept_dict_words PASSED   [ 80%]
tests/test_pick_word.py::test_pick_word_ok_length PASSED                 [100%]

- generated xml file: /home/jiby/dev/ws/short/literate_wordle/test_results/results.xml -

----------- coverage: platform linux, python 3.9.5-final-0 -----------
Name                                     Stmts   Miss  Cover
------------------------------------------------------------
src/literate_wordle/__init__.py              1      0   100%
src/literate_wordle/assets/__init__.py       0      0   100%
src/literate_wordle/words.py                23      0   100%
------------------------------------------------------------
TOTAL                                       24      0   100%
Coverage HTML written to dir test_results/coverage.html
Coverage XML written to file test_results/coverage.xml

============================== 5 passed in 0.09s ===============================
poetry build
Building literate_wordle (0.1.0)
  - Building sdist
  - Built literate_wordle-0.1.0.tar.gz
  - Building wheel
  - Built literate_wordle-0.1.0-py3-none-any.whl
</pre>

<p>
Tests pass, coverage stays strong, and linters are quiet, this is great!
</p>
</div>
</div>

<div id="outline-container-orgabe36c7" class="outline-3">
<h3 id="orgabe36c7"><span class="section-number-3">2.3.</span> Performance trick</h3>
<div class="outline-text-3" id="text-2-3">
<p>
We mentioned before in footnotes that the whole dictionary would get unzipped on
every request for such an asset. Now we&rsquo;re validating guessed words, we may want
to be processing guesses quite quickly, certainly quicker than one would pick
words!
</p>

<p>
What we want to make all this fast, is to make the dictionary unzipping cached,
so that repeated calls to the function <code>get_asset_zip_as_set</code> don&rsquo;t bother with
file open and unzip. There&rsquo;s a handy python decorator that does the trick! Let&rsquo;s
add <code>functools.cache</code> on top of our slow function:
</p>


<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 14: </span>Import the cache function</label><pre class="src src-python" id="org1dd39e0"><span style="color: #51afef;">from</span> functools <span style="color: #51afef;">import</span> cache
</pre>
</div>



<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 15: </span>Decorator to make a function use cache</label><pre class="src src-python" id="orgded8793"><span style="color: #ECBE7B;">@cache</span>
</pre>
</div>

<p>
After rerunning our tests, we now have a (theoretically) faster function, yey!
</p>

<p>
Remember that we committed a couple of performance/optimization sins just then,
by both: optimizing prematurely (with no proof of slowness), and by doing
optimization without using profiling information to optimize, we very likely
just optimized something that isn&rsquo;t our bottleneck. I&rsquo;m fine with that, just
wanted to showcase this cool decorator, which functions like an unbounded
memoizer. But just in case, let&rsquo;s see quick performance numbers of before/after:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 16: </span>Before cacheing, running 5 batches of a thousand double-dict-unzip</label><pre class="src src-shell" id="org19fc7e9">poetry run python3 -m timeit -v -n <span style="color: #da8548; font-weight: bold;">1000</span> --setup <span style="color: #98be65;">"from literate_wordle.words import pick_answer_word, check_valid_word"</span> <span style="color: #98be65;">"check_valid_word(pick_answer_word())"</span>
</pre>
</div>

<pre class="example">
raw times: 2.75 sec, 2.72 sec, 2.73 sec, 2.73 sec, 2.72 sec

1000 loops, best of 5: 2.72 msec per loop
</pre>


<p>
And after cacheing:
</p>

<pre class="example">
raw times: 17.1 msec, 12.8 msec, 12.6 msec, 12.8 msec, 12.4 msec

1000 loops, best of 5: 12.4 usec per loop
</pre>


<p>
That&rsquo;s a two orders of magnitude gain for a single line of code changed.
</p>
</div>
</div>

<div id="outline-container-orge8afa44" class="outline-3">
<h3 id="orge8afa44"><span class="section-number-3">2.4.</span> Tangle out all the code</h3>
<div class="outline-text-3" id="text-2-4">
<p>
Last section of this file used for internal purposes:
Code defined above is usually out of order, especially the imports. To avoid
having nonsence python files with import-feature-import-feature sequences, which
formatters would go crazy over, we define below some reordered code blocks,
using the <code>noweb</code> feature of org-mode, that tangle out into the proper files
with proper ordering and spacing.
</p>

<p>
This means we need to manually weave the code blocks, instead of just stating
they all point to the same file and rely on file top-to-bottom order, we have an
explicit code block where we template out &ldquo;add this bit, now 2 lines below add
that snippet, and then&#x2026;&rdquo;. Not ideal, but it has the added benefit of allowing
custom layout like number of lines jumped between functions, which was blocking
adoption of the formatter &ldquo;black&rdquo; in this repository.
</p>

<p>
First, fix words.py imports being out of order in our narrative by tangling them
via noweb to weave the part 1 imports with the part 2. This means <code>isort</code>
(import sorter) is now happy, won&rsquo;t thrash these python files. Also insert the
cache decorator before the assets function, and substitute the
<code>check_valid_word</code> function body with the real implementation instead of the
dummy function defined initially.
</p>

<div class="org-src-container">
<pre class="src src-python" id="org9c3a9ae">
<span style="color: #51afef;">import</span> gzip
<span style="color: #51afef;">import</span> importlib.resources <span style="color: #51afef;">as</span> pkg_resources
<span style="color: #51afef;">from</span> functools <span style="color: #51afef;">import</span> cache
<span style="color: #51afef;">from</span> random <span style="color: #51afef;">import</span> choice
<span style="color: #51afef;">from</span> typing <span style="color: #51afef;">import</span> Optional, Tuple

<span style="color: #51afef;">from</span> . <span style="color: #51afef;">import</span> assets  <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Relative import of the assets/ folder</span>


<span style="color: #ECBE7B;">@cache</span>
<span style="color: #51afef;">def</span> <span style="color: #c678dd;">get_asset_zip_as_set</span><span style="color: #FF8811;">(</span>asset_filename: <span style="color: #c678dd;">str</span><span style="color: #FF8811;">)</span> -&gt; <span style="color: #c678dd;">set</span><span style="color: #FF8811;">[</span><span style="color: #c678dd;">str</span><span style="color: #FF8811;">]</span>:
    <span style="color: #83898d;">"""Decompress a file in assets module into a set of words, separated by newline"""</span>
    <span style="color: #dcaeea;">compressed_bytes</span> = pkg_resources.read_binary<span style="color: #FF8811;">(</span>assets, asset_filename<span style="color: #FF8811;">)</span>
    <span style="color: #dcaeea;">string</span> = gzip.decompress<span style="color: #FF8811;">(</span>compressed_bytes<span style="color: #FF8811;">)</span>.decode<span style="color: #FF8811;">(</span><span style="color: #98be65;">"ascii"</span><span style="color: #FF8811;">)</span>
    <span style="color: #dcaeea;">string_list</span> = <span style="color: #FF8811;">[</span>word.strip<span style="color: #8F0;">()</span>.lower<span style="color: #8F0;">()</span> <span style="color: #51afef;">for</span> word <span style="color: #51afef;">in</span> string.split<span style="color: #8F0;">(</span><span style="color: #98be65;">"\n"</span><span style="color: #8F0;">)</span><span style="color: #FF8811;">]</span>
    <span style="color: #51afef;">return</span> <span style="color: #c678dd;">set</span><span style="color: #FF8811;">(</span>string_list<span style="color: #FF8811;">)</span>


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">pick_answer_word</span><span style="color: #FF8811;">()</span> -&gt; <span style="color: #c678dd;">str</span>:
    <span style="color: #83898d;">"""Pick a single word out of the dictionary of answers"""</span>
    <span style="color: #51afef;">return</span> choice<span style="color: #FF8811;">(</span><span style="color: #c678dd;">list</span><span style="color: #8F0;">(</span>get_asset_zip_as_set<span style="color: #55DDFF;">(</span><span style="color: #98be65;">"wordle_answers_dict.txt.gz"</span><span style="color: #55DDFF;">)</span><span style="color: #8F0;">)</span><span style="color: #FF8811;">)</span>


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">check_valid_word</span><span style="color: #FF8811;">(</span>guess: <span style="color: #c678dd;">str</span><span style="color: #FF8811;">)</span> -&gt; Tuple<span style="color: #FF8811;">[</span><span style="color: #c678dd;">bool</span>, Optional<span style="color: #8F0;">[</span><span style="color: #c678dd;">str</span><span style="color: #8F0;">]</span><span style="color: #FF8811;">]</span>:
    <span style="color: #83898d;">"""Check a wordle guess is valid: length and in dictionary"""</span>
    <span style="color: #dcaeea;">answer_length</span> = <span style="color: #da8548; font-weight: bold;">5</span>
    <span style="color: #dcaeea;">guess_length</span> = <span style="color: #c678dd;">len</span><span style="color: #FF8811;">(</span>guess<span style="color: #FF8811;">)</span>
    <span style="color: #51afef;">if</span> guess_length &lt; answer_length:
        <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">False</span>, <span style="color: #98be65;">"Guess too short"</span>
    <span style="color: #51afef;">elif</span> guess_length &gt; answer_length:
        <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">False</span>, <span style="color: #98be65;">"Guess too long"</span>
    <span style="color: #dcaeea;">valid_words_dict</span> = get_asset_zip_as_set<span style="color: #FF8811;">(</span><span style="color: #98be65;">"wordle_accepted_words_dict.txt.gz"</span><span style="color: #FF8811;">)</span>
    <span style="color: #51afef;">if</span> guess <span style="color: #51afef;">in</span> valid_words_dict:
        <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">True</span>, <span style="color: #a9a1e1;">None</span>
    <span style="color: #51afef;">return</span> <span style="color: #a9a1e1;">False</span>, <span style="color: #98be65;">"Not a word from the dictionary"</span>
</pre>
</div>

<p>
Now the same thing with the tests file, which indeed <i>is</i> in proper order
already, but would benefit from two-lines-between-tests to guarantee formatting:
</p>

<div class="org-src-container">
<pre class="src src-python" id="orgc3c0561">
<span style="color: #51afef;">from</span> literate_wordle.words <span style="color: #51afef;">import</span> check_valid_word


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_reject_long_words</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: Reject long words"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When guessing "affable"</span>
    <span style="color: #dcaeea;">guess</span> = <span style="color: #98be65;">"affable"</span>
    <span style="color: #dcaeea;">is_valid</span>, <span style="color: #dcaeea;">reject_reason</span> = check_valid_word<span style="color: #FF8811;">(</span>guess<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then the guess is rejected</span>
    <span style="color: #51afef;">assert</span> <span style="color: #51afef;">not</span> is_valid, <span style="color: #98be65;">"Overly long guess should have been rejected"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And reason for rejection is "Guess too long"</span>
    <span style="color: #51afef;">assert</span> reject_reason == <span style="color: #98be65;">"Guess too long"</span>


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_reject_overly_short_words</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: Reject short words"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When guessing "baby"</span>
    <span style="color: #dcaeea;">guess</span> = <span style="color: #98be65;">"baby"</span>
    <span style="color: #dcaeea;">is_valid</span>, <span style="color: #dcaeea;">reject_reason</span> = check_valid_word<span style="color: #FF8811;">(</span>guess<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then the guess is rejected</span>
    <span style="color: #51afef;">assert</span> <span style="color: #51afef;">not</span> is_valid, <span style="color: #98be65;">"Overly short guess should have been rejected"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And reason for rejection is "Guess too short"</span>
    <span style="color: #51afef;">assert</span> reject_reason == <span style="color: #98be65;">"Guess too short"</span>


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_reject_nondict_words</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: Reject fake words via dictionary"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When guessing "vbpdj"</span>
    <span style="color: #dcaeea;">guess</span> = <span style="color: #98be65;">"vbpdj"</span>
    <span style="color: #dcaeea;">is_valid</span>, <span style="color: #dcaeea;">reject_reason</span> = check_valid_word<span style="color: #FF8811;">(</span>guess<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then the guess is rejected</span>
    <span style="color: #51afef;">assert</span> <span style="color: #51afef;">not</span> is_valid, <span style="color: #98be65;">"Word not in dictionary should have been rejected"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And reason for rejection is "Not a word from the dictionary"</span>
    <span style="color: #51afef;">assert</span> reject_reason == <span style="color: #98be65;">"Not a word from the dictionary"</span>


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_accept_dict_words</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: Accept five letter dictionary words"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When guessing "crane"</span>
    <span style="color: #dcaeea;">guess</span> = <span style="color: #98be65;">"crane"</span>
    <span style="color: #dcaeea;">is_valid</span>, <span style="color: #dcaeea;">reject_reason</span> = check_valid_word<span style="color: #FF8811;">(</span>guess<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then the guess is accepted</span>
    <span style="color: #51afef;">assert</span> is_valid, <span style="color: #98be65;">"Correct length word in dictionary should have been accepted"</span>
    <span style="color: #51afef;">assert</span> reject_reason <span style="color: #51afef;">is</span> <span style="color: #a9a1e1;">None</span>, <span style="color: #98be65;">"Accepted word should have no reason to be rejected"</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org786c0aa" class="outline-2">
<h2 id="org786c0aa"><span class="section-number-2">3.</span> Calculating guessed word&rsquo;s score</h2>
<div class="outline-text-2" id="text-3">
<p>
We can pick answer words, and we can check if a guess is a valid word, now we
have everything we need to score the guess! Let&rsquo;s first define the overall
feature:
</p>

<div class="org-src-container">
<pre class="src src-feature" id="org1887b84"><span style="color: #51afef;">Feature:</span><span style="color: #ECBE7B;"> Scoring guesses</span>
  As a Wordle game
  I need to tell the player how good their guess is
  In order to help them find the proper answer
</pre>
</div>

<p>
This sounds simple, but implementing this feature is tricky, because of edge
cases like multiple identical character in the answer, which need colored
appropriately (What&rsquo;s the proper way to do that? We need to pin it down in
requirements!). So let&rsquo;s define <i>Gherkin Scenarios</i> for that feature, to give
examples of how the feature works in practice. So we write out
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 17: </span>The winning guess scenario</label><pre class="src src-feature" id="org4ff0752"><span style="color: #51afef;">Scenario:</span><span style="color: #c678dd;"> Perfect guess gives perfect score</span>
<span style="color: #51afef;">  Given</span> a wordle answer <span style="color: #98be65;">"crane"</span>
<span style="color: #51afef;">  When</span> scoring the guess <span style="color: #98be65;">"crane"</span>
<span style="color: #51afef;">  Then</span> score should be <span style="color: #98be65;">"&#129001;&#129001;&#129001;&#129001;&#129001;"</span>
</pre>
</div>

<p>
This seems easy enough, but we notice that we are making an assumption that&rsquo;s
not written out, which makes this feature depend on another: We&rsquo;re assuming the
guess is a valid word! We may want to just add another <code>Given</code>, like:
</p>

<div class="org-src-container">
<pre class="src src-feature"><span style="color: #51afef;">  Given</span> a guess that's a valid dictionary word
</pre>
</div>

<p>
But this isn&rsquo;t just a hypothesis from the current scenario, it&rsquo;s valid for all
scenarios of this feature. To avoid the tedious copying of that assumption, we
can use a <code>Gherkin Background</code> for the feature:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 18: </span>Pre-condition that applies to all the scenarios of this feature file</label><pre class="src src-feature" id="org9b17c99"><span style="color: #51afef;">Background:</span>
<span style="color: #51afef;">  Given</span> a guess that's a valid dictionary word
</pre>
</div>

<p>
Perfect, so now we&rsquo;re assuming the guess is a valid word, which means a
dependency on having implemented the previous feature, but we&rsquo;re not specifying
the guess word itself, which can still be scenario specific. This makes our
initial &ldquo;perfect guess&rdquo; scenario valid again, so we can use it
</p>

<p>
Note that our scenario doesn&rsquo;t make assumption of how many attempts at Wordle
we&rsquo;re at, or the fact of winning or losing. This is purely a hypothetical
scenario, disjoint from the feature of actually playing a game.
</p>

<p>
If we&rsquo;ve got the perfect answer, let&rsquo;s have the opposite:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 19: </span>Flunking out scenario</label><pre class="src src-feature" id="org6d11ac6"><span style="color: #51afef;">Scenario:</span><span style="color: #c678dd;"> No character in common</span>
<span style="color: #51afef;">  Given</span> a wordle answer <span style="color: #98be65;">"brave"</span>
<span style="color: #51afef;">  When</span> scoring the guess <span style="color: #98be65;">"skill"</span>
<span style="color: #51afef;">  Then</span> score should be <span style="color: #98be65;">"&#11036;&#11036;&#11036;&#11036;&#11036;"</span>
</pre>
</div>
</div>

<div id="outline-container-orgd9e5b78" class="outline-3">
<h3 id="orgd9e5b78"><span class="section-number-3">3.1.</span> Can we start coding yet?</h3>
<div class="outline-text-3" id="text-3-1">
<p>
At this point, we only need to add a &ldquo;🟨&rdquo; scenario and we could conceivably
start the implementation work already, we have work to do!
</p>

<p>
The problem of &ldquo;what to do now&rdquo; is interesting, because we can continue thinking
up scenarios in Gherkin as a design exercise for a while, or we could already
start writing test code to back these claims, leading to failed tests, and then
start on implementation early to aim for green tests, only to add scenarios as
we realize that our implementation is lacking compared to the original intent of
the game.
</p>

<p>
While it&rsquo;s tempting to jump into code first, I believe we should pin down the
exact requirements on a &ldquo;whiteboard&rdquo; of sorts (in that case: Gherkin features
and scenarios), before starting to touch any code. It&rsquo;s easy to get tunnel
vision when writing code, getting excited about the programming problems, losing
track of what the &ldquo;user&rdquo; wants. We need to write down the exact user needs
first, so as to have a proper ritual during which to &ldquo;switch from &lsquo;User&rsquo; hat to
&lsquo;Developer&rsquo; hat&rdquo;.
</p>
</div>
</div>

<div id="outline-container-org0529797" class="outline-3">
<h3 id="org0529797"><span class="section-number-3">3.2.</span> Finalizing the scenarios</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Back to our gherkin scenarios, let&rsquo;s add the yellow marker one:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 20: </span>Wrong place case</label><pre class="src src-feature" id="orgb52522f"><span style="color: #51afef;">Scenario:</span><span style="color: #c678dd;"> Character in wrong place</span>
<span style="color: #51afef;">  Given</span> a wordle answer <span style="color: #98be65;">"rebus"</span>
<span style="color: #51afef;">  When</span> scoring the guess <span style="color: #98be65;">"skull"</span>
<span style="color: #51afef;">  Then</span> score should be <span style="color: #98be65;">"&#129000;&#11036;&#129000;&#11036;&#11036;"</span>
</pre>
</div>

<p>
And just for having a good sample of tests with which to test, let&rsquo;s use a table
of example to confirm scoring works out:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 21: </span>Many examples via Gherkin Scenario Outlines and Examples</label><pre class="src src-feature" id="org58d0197"><span style="color: #51afef;">Scenario Outline:</span><span style="color: #c678dd;"> Scoring guesses</span>
<span style="color: #51afef;">  Given</span> a wordle <span style="color: #dcaeea;">&lt;answer&gt;</span>
<span style="color: #51afef;">  When</span> scoring <span style="color: #dcaeea;">&lt;guess&gt;</span>
<span style="color: #51afef;">  Then</span> score should be <span style="color: #dcaeea;">&lt;score&gt;</span>

<span style="color: #5B6268;"># Emoji (Unicode) character rendering is hard:</span>
<span style="color: #5B6268;"># Please forgive the table column alignment issues!</span>
<span style="color: #51afef;">  Examples:</span> A few guesses and their score
<span style="color: #a9a1e1;">    | answer  | guess   | score     |</span>
<span style="color: #a9a1e1;">    | adage   | adobe   | &#129001;&#129001;&#11036;&#11036;&#129001; |</span>
<span style="color: #a9a1e1;">    | serif   | quiet   | &#11036;&#11036;&#129000;&#129000;&#11036; |</span>
<span style="color: #a9a1e1;">    | raise   | radix   | &#129001;&#129001;&#11036;&#129000;&#11036; |</span>
</pre>
</div>

<p>
Note how the &ldquo;outline&rdquo; system maps really well to the idea of <a href="https://docs.pytest.org/en/6.2.x/parametrize.html">pytest&rsquo;s
parametrized tests</a>. We can write the test case <i>once</i>, and have a decorator deal
with the multiple instantiations
</p>

<p>
All right, that&rsquo;s a few, moving on. But here is the most difficult to implement
corner case, written out as examples of the previous scenario:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 22: </span>Edge case: duplicate character in answer or guess</label><pre class="src src-feature" id="orgd3e962d"><span style="color: #51afef;">  Examples:</span> Multiple occurences of same character
<span style="color: #a9a1e1;">    | answer | guess    | score     |</span>
<span style="color: #a9a1e1;">    | abbey  | kebab    | &#11036;&#129000;&#129001;&#129000;&#129000; |</span>
<span style="color: #a9a1e1;">    | abbey  | babes    | &#129000;&#129000;&#129001;&#129001;&#11036; |</span>
<span style="color: #a9a1e1;">    | abbey  | abyss    | &#129001;&#129001;&#129000;&#11036;&#11036; |</span>
<span style="color: #a9a1e1;">    | abbey  | algae    | &#129001;&#11036;&#11036;&#11036;&#129000; |</span>
<span style="color: #a9a1e1;">    | abbey  | keeps    | &#11036;&#129000;&#11036;&#11036;&#11036; |</span>
<span style="color: #a9a1e1;">    | abbey  | abate    | &#129001;&#129001;&#11036;&#11036;&#129000; |</span>
</pre>
</div>

<p>
These sample answers and scores were <a href="https://nerdschalk.com/wordle-same-letter-twice-rules-explained-how-does-it-work/">taken from online example screenshots</a> of
the original website, hence considered accurate references.
</p>

<p>
With &ldquo;abbey&rdquo; as reference, the &ldquo;kebab&rdquo; answer seems logical, with first &ldquo;b&rdquo;
occurence matching as green, and the second being in the wrong place. The
surprise comes from &ldquo;keeps&rdquo; where the first e counts, but the second doesn&rsquo;t
have an equivalent in the answer, hence flagged as &ldquo;no such character&rdquo;. That
makes sense, but that&rsquo;s not how a naive implementation of the game would do it!
</p>


<p>
Out of curiosity, I wonder if there&rsquo;s any wordle answers that contain three
identical characters? Let&rsquo;s see!
</p>

<div class="org-src-container">
<pre class="src src-shell">zgrep -i -E <span style="color: #98be65;">"([a-z]).*\1.*\1"</span> src/literate_wordle/assets/wordle_answers_dict.txt.gz | wc -l
</pre>
</div>

<pre class="example">
20
</pre>


<p>
Really? 20? That&rsquo;s harsh &#x2026; show me one?
</p>

<div class="org-src-container">
<pre class="src src-shell">zgrep -i -E <span style="color: #98be65;">"([a-z]).*\1.*\1"</span> src/literate_wordle/assets/wordle_answers_dict.txt.gz | head -n <span style="color: #da8548; font-weight: bold;">1</span> | sed <span style="color: #98be65;">'s/\r//'</span>
</pre>
</div>

<pre class="example">
bobby
</pre>


<p>
Interesting. That must be hard to solve I imagine.
</p>
</div>
</div>
<div id="outline-container-org7b5440a" class="outline-3">
<h3 id="org7b5440a"><span class="section-number-3">3.3.</span> Writing up acceptance tests</h3>
<div class="outline-text-3" id="text-3-3">
<p>
With no more obvious pathological cases to cover in requirements, it&rsquo;s time to
switch to our developer hat, and write some (acceptance) tests!
</p>

<p>
This involves figuring out what our feature is going to be called, and what
module it&rsquo;s going to be in.
</p>

<p>
Jumping to the obvious here, we&rsquo;ll make the feature a separate <code>guess.py</code>.
</p>
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 23: </span>guess.py module-level docstring</label><pre class="src src-python" id="org39c43f3"><span style="color: #83898d;">"""Score guesses of Wordle game"""</span>
</pre>
</div>

<p>
And I imagine a function called <code>score_guess</code>, initially returning a junk
string:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 24: </span>score_guess first draft</label><pre class="src src-python" id="org2298823"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">score_guess</span><span style="color: #FF8811;">(</span>guess: <span style="color: #c678dd;">str</span>, answer: <span style="color: #c678dd;">str</span><span style="color: #FF8811;">)</span> -&gt; <span style="color: #c678dd;">str</span>:
    <span style="color: #83898d;">"""Score an individual guess"""</span>
    <span style="color: #51afef;">return</span> <span style="color: #98be65;">"&#11036;"</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 25: </span>Importing the feature, first</label><pre class="src src-python" id="org1537b64"><span style="color: #51afef;">from</span> literate_wordle.guess <span style="color: #51afef;">import</span> score_guess
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 26: </span>First acceptance test using &ldquo;Perfect guess&rdquo; scenario</label><pre class="src src-python" id="orgcd11653"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_perfect_guess</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: Perfect guess gives perfect score"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Given a wordle answer "crane"</span>
    <span style="color: #dcaeea;">answer</span> = <span style="color: #98be65;">"crane"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When scoring the guess "crane"</span>
    <span style="color: #dcaeea;">our_guess</span> = <span style="color: #98be65;">"crane"</span>
    <span style="color: #dcaeea;">score</span> = score_guess<span style="color: #FF8811;">(</span>our_guess, answer<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then score should be "&#129001;&#129001;&#129001;&#129001;&#129001;"</span>
    <span style="color: #51afef;">assert</span> score == <span style="color: #98be65;">"&#129001;&#129001;&#129001;&#129001;&#129001;"</span>, <span style="color: #98be65;">"Perfect answer should give Perfect Score"</span>
</pre>
</div>

<p>
Now the test should fail appropriately, let&rsquo;s add a twist: we&rsquo;ll mark the
function as expected to fail, because for now it&rsquo;s not been implemented. This
allows pytest to mark all tests as passed despite failures, and is perfect for
either bug reports being worked on, or new features being built.
</p>


<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 27: </span>Importing the pytest module to get to pytest.mark</label><pre class="src src-python" id="org118b219"><span style="color: #51afef;">import</span> pytest
</pre>
</div>



<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 28: </span>Marking the feature as expected to fail, causing tests to not alert.</label><pre class="src src-python" id="orgc25f075"><span style="color: #ECBE7B;">@pytest.mark.xfail</span><span style="color: #FF8811;">(</span>reason=<span style="color: #98be65;">"Not implemented yet"</span><span style="color: #FF8811;">)</span>
</pre>
</div>

<p>
Confirm these tests work, marked as xfail:
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #ECBE7B;">make</span> test
</pre>
</div>

<pre class="example" id="org206d088">
poetry run pytest
============================= test session starts ==============================
platform linux -- Python 3.9.5, pytest-6.2.5, py-1.11.0, pluggy-1.0.0 -- /home/jiby/dev/ws/short/literate_wordle/.venv/bin/python
cachedir: .pytest_cache
rootdir: /home/jiby/dev/ws/short/literate_wordle, configfile: pyproject.toml
plugins: cov-3.0.0, clarity-1.0.1
collecting ... collected 6 items

tests/test_checking_guess_valid_word.py::test_reject_long_words PASSED   [ 16%]
tests/test_checking_guess_valid_word.py::test_reject_overly_short_words PASSED [ 33%]
tests/test_checking_guess_valid_word.py::test_reject_nondict_words PASSED [ 50%]
tests/test_checking_guess_valid_word.py::test_accept_dict_words PASSED   [ 66%]
tests/test_pick_word.py::test_pick_word_ok_length PASSED                 [ 83%]
tests/test_scoring_guess.py::test_perfect_guess XFAIL (Not implement...) [100%]

- generated xml file: /home/jiby/dev/ws/short/literate_wordle/test_results/results.xml -

----------- coverage: platform linux, python 3.9.5-final-0 -----------
Name                                     Stmts   Miss  Cover
------------------------------------------------------------
src/literate_wordle/__init__.py              1      0   100%
src/literate_wordle/assets/__init__.py       0      0   100%
src/literate_wordle/guess.py                 2      0   100%
src/literate_wordle/words.py                25      0   100%
------------------------------------------------------------
TOTAL                                       28      0   100%
Coverage HTML written to dir test_results/coverage.html
Coverage XML written to file test_results/coverage.xml

========================= 5 passed, 1 xfailed in 0.10s =========================
</pre>
</div>
</div>

<div id="outline-container-orga75603e" class="outline-3">
<h3 id="orga75603e"><span class="section-number-3">3.4.</span> More tests</h3>
<div class="outline-text-3" id="text-3-4">
<p>
Let&rsquo;s implement the rest of the failing tests, so we can make it all red, then
fix the implementation:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 29: </span>Second acceptance test using &ldquo;no character in common&rdquo; scenario</label><pre class="src src-python" id="org2f5e8a3"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_no_common_character</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: No character in common"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Given a wordle answer "brave"</span>
    <span style="color: #dcaeea;">answer</span> = <span style="color: #98be65;">"brave"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When scoring the guess "skill"</span>
    <span style="color: #dcaeea;">our_guess</span> = <span style="color: #98be65;">"skill"</span>
    <span style="color: #dcaeea;">score</span> = score_guess<span style="color: #FF8811;">(</span>our_guess, answer<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then score should be "&#11036;&#11036;&#11036;&#11036;&#11036;"</span>
    <span style="color: #51afef;">assert</span> score == <span style="color: #98be65;">"&#11036;&#11036;&#11036;&#11036;&#11036;"</span>, <span style="color: #98be65;">"No character in common with answer should give 0 score"</span>
</pre>
</div>


<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 30: </span>Third acceptance test using &ldquo;Characters in wrong place&rdquo; scenario</label><pre class="src src-python" id="org73339dd"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_wrong_place</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: Character in wrong place"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Given a wordle answer "rebus"</span>
    <span style="color: #dcaeea;">answer</span> = <span style="color: #98be65;">"rebus"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When scoring the guess "skull"</span>
    <span style="color: #dcaeea;">our_guess</span> = <span style="color: #98be65;">"skull"</span>
    <span style="color: #dcaeea;">score</span> = score_guess<span style="color: #FF8811;">(</span>our_guess, answer<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then score should be "&#129000;&#11036;&#129000;&#11036;&#11036;"</span>
    <span style="color: #51afef;">assert</span> score == <span style="color: #98be65;">"&#129000;&#11036;&#129000;&#11036;&#11036;"</span>, <span style="color: #98be65;">"Characters are in the wrong place"</span>
</pre>
</div>

<p>
That covers the first three scenarios.
</p>

<p>
For the Scenario Outline, it&rsquo;s interesting to notice that a pattern emerged,
which allows the same test skeleton to be reused with different data. In Pytest,
this can be done by &ldquo;parametrizing&rdquo; the test with multiple data entries.
</p>

<p>
Usually this is just a matter of a decorator to signify the data, but since
we&rsquo;re trying to make multiple separate tests from the different data sets, we
can use a <a href="https://docs.pytest.org/en/6.2.x/example/parametrize.html#set-marks-or-test-id-for-individual-parametrized-test">stronger kind of parametrization</a>:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 31: </span>Generic acceptance test</label><pre class="src src-python" id="org2aa8cbd"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_generic_score</span><span style="color: #FF8811;">(</span>answer, our_guess, expected_score<span style="color: #FF8811;">)</span>:
    <span style="color: #83898d;">"""Scenario Outline: Scoring guesses"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Given a wordle &lt;answer&gt;</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When scoring &lt;guess&gt;</span>
    <span style="color: #dcaeea;">score</span> = score_guess<span style="color: #FF8811;">(</span>our_guess, answer<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then score should be &lt;score&gt;</span>
    <span style="color: #51afef;">assert</span> score == expected_score
</pre>
</div>

<p>
Just need to fill in the parameters:
</p>
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 32: </span>Parameters for generic test</label><pre class="src src-python" id="org7c98e3a"><span style="color: #ECBE7B;">@pytest.mark.parametrize</span><span style="color: #FF8811;">(</span>
    <span style="color: #98be65;">"answer,our_guess,expected_score"</span>,
    <span style="color: #8F0;">[</span>
        pytest.param<span style="color: #55DDFF;">(</span><span style="color: #98be65;">"adage"</span>, <span style="color: #98be65;">"adobe"</span>, <span style="color: #98be65;">"&#129001;&#129001;&#11036;&#11036;&#129001;"</span>, <span style="color: #c678dd;">id</span>=<span style="color: #98be65;">"normal_guess1"</span><span style="color: #55DDFF;">)</span>,
        pytest.param<span style="color: #55DDFF;">(</span><span style="color: #98be65;">"serif"</span>, <span style="color: #98be65;">"quiet"</span>, <span style="color: #98be65;">"&#11036;&#11036;&#129000;&#129000;&#11036;"</span>, <span style="color: #c678dd;">id</span>=<span style="color: #98be65;">"normal_guess2"</span><span style="color: #55DDFF;">)</span>,
        pytest.param<span style="color: #55DDFF;">(</span><span style="color: #98be65;">"raise"</span>, <span style="color: #98be65;">"radix"</span>, <span style="color: #98be65;">"&#129001;&#129001;&#11036;&#129000;&#11036;"</span>, <span style="color: #c678dd;">id</span>=<span style="color: #98be65;">"normal_guess3"</span><span style="color: #55DDFF;">)</span>,
        pytest.param<span style="color: #55DDFF;">(</span><span style="color: #98be65;">"abbey"</span>, <span style="color: #98be65;">"kebab"</span>, <span style="color: #98be65;">"&#11036;&#129000;&#129001;&#129000;&#129000;"</span>, <span style="color: #c678dd;">id</span>=<span style="color: #98be65;">"multi_occur1"</span><span style="color: #55DDFF;">)</span>,
        pytest.param<span style="color: #55DDFF;">(</span><span style="color: #98be65;">"abbey"</span>, <span style="color: #98be65;">"babes"</span>, <span style="color: #98be65;">"&#129000;&#129000;&#129001;&#129001;&#11036;"</span>, <span style="color: #c678dd;">id</span>=<span style="color: #98be65;">"multi_occur2"</span><span style="color: #55DDFF;">)</span>,
        pytest.param<span style="color: #55DDFF;">(</span><span style="color: #98be65;">"abbey"</span>, <span style="color: #98be65;">"abyss"</span>, <span style="color: #98be65;">"&#129001;&#129001;&#129000;&#11036;&#11036;"</span>, <span style="color: #c678dd;">id</span>=<span style="color: #98be65;">"multi_occur3"</span><span style="color: #55DDFF;">)</span>,
        pytest.param<span style="color: #55DDFF;">(</span><span style="color: #98be65;">"abbey"</span>, <span style="color: #98be65;">"algae"</span>, <span style="color: #98be65;">"&#129001;&#11036;&#11036;&#11036;&#129000;"</span>, <span style="color: #c678dd;">id</span>=<span style="color: #98be65;">"multi_occur4"</span><span style="color: #55DDFF;">)</span>,
        pytest.param<span style="color: #55DDFF;">(</span><span style="color: #98be65;">"abbey"</span>, <span style="color: #98be65;">"keeps"</span>, <span style="color: #98be65;">"&#11036;&#129000;&#11036;&#11036;&#11036;"</span>, <span style="color: #c678dd;">id</span>=<span style="color: #98be65;">"multi_occur5"</span><span style="color: #55DDFF;">)</span>,
        pytest.param<span style="color: #55DDFF;">(</span><span style="color: #98be65;">"abbey"</span>, <span style="color: #98be65;">"abate"</span>, <span style="color: #98be65;">"&#129001;&#129001;&#11036;&#11036;&#129000;"</span>, <span style="color: #c678dd;">id</span>=<span style="color: #98be65;">"multi_occur6"</span><span style="color: #55DDFF;">)</span>,
    <span style="color: #8F0;">]</span>,
<span style="color: #FF8811;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbe32fa7" class="outline-3">
<h3 id="orgbe32fa7"><span class="section-number-3">3.5.</span> Implementing the feature</h3>
<div class="outline-text-3" id="text-3-5">
<p>
With the amount of prep we did, the little scoring function can be safely done.
</p>

<p>
Let&rsquo;s experiment with the solution, iterating over naive solution and seeing how
close they get to implementing the feature, by number of tests failed.
</p>

<p>
Before anything, we go to the bottom of this file, where the tangling happens,
and remove the &ldquo;xfail&rdquo; marker, so that test failures actually notify us as
failures.
</p>

<p>
First, a simple string matching by iterating over both lists at once:
</p>

<div class="org-src-container">
<pre class="src src-python" id="org6dbefe7"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">score_guess</span><span style="color: #FF8811;">(</span>guess: <span style="color: #c678dd;">str</span>, answer: <span style="color: #c678dd;">str</span><span style="color: #FF8811;">)</span> -&gt; <span style="color: #c678dd;">str</span>:
    <span style="color: #83898d;">"""Score an individual guess naively"""</span>
    <span style="color: #dcaeea;">NO</span> = <span style="color: #98be65;">"&#11036;"</span>
    <span style="color: #dcaeea;">OK</span> = <span style="color: #98be65;">"&#129001;"</span>
    <span style="color: #dcaeea;">response</span> = <span style="color: #98be65;">""</span>
    <span style="color: #51afef;">for</span> answer_char, guess_char <span style="color: #51afef;">in</span> <span style="color: #c678dd;">zip</span><span style="color: #FF8811;">(</span>answer, guess<span style="color: #FF8811;">)</span>:
        <span style="color: #51afef;">if</span> answer_char == guess_char:
            <span style="color: #dcaeea;">response</span> += OK
        <span style="color: #51afef;">else</span>:
            <span style="color: #dcaeea;">response</span> += NO
    <span style="color: #51afef;">return</span> response
</pre>
</div>

<p>
That only passes 3 tests of the 12 we just defined, obviously because we don&rsquo;t
deal with incorrect characters. So let&rsquo;s add keeping track of characters in the
wrong places:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 33: </span>Keep track of all answer characters</label><pre class="src src-python" id="orgd4b6af5"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">score_guess</span><span style="color: #FF8811;">(</span>guess: <span style="color: #c678dd;">str</span>, answer: <span style="color: #c678dd;">str</span><span style="color: #FF8811;">)</span> -&gt; <span style="color: #c678dd;">str</span>:
    <span style="color: #83898d;">"""Score an individual guess a little less naively"""</span>
    <span style="color: #dcaeea;">NO</span> = <span style="color: #98be65;">"&#11036;"</span>
    <span style="color: #dcaeea;">OK</span> = <span style="color: #98be65;">"&#129001;"</span>
    <span style="color: #dcaeea;">WRONG_PLACE</span> = <span style="color: #98be65;">"&#129000;"</span>
    <span style="color: #dcaeea;">answer_chars_set</span> = <span style="color: #c678dd;">set</span><span style="color: #FF8811;">(</span><span style="color: #c678dd;">list</span><span style="color: #8F0;">(</span>answer<span style="color: #8F0;">)</span><span style="color: #FF8811;">)</span>
    <span style="color: #dcaeea;">response</span> = <span style="color: #98be65;">""</span>
    <span style="color: #51afef;">for</span> answer_char, guess_char <span style="color: #51afef;">in</span> <span style="color: #c678dd;">zip</span><span style="color: #FF8811;">(</span>answer, guess<span style="color: #FF8811;">)</span>:
        <span style="color: #51afef;">if</span> answer_char == guess_char:
            <span style="color: #dcaeea;">response</span> += OK
        <span style="color: #51afef;">elif</span> guess_char <span style="color: #51afef;">in</span> answer_chars_set:
            <span style="color: #dcaeea;">response</span> += WRONG_PLACE
        <span style="color: #51afef;">else</span>:
            <span style="color: #dcaeea;">response</span> += NO
    <span style="color: #51afef;">return</span> response
</pre>
</div>

<p>
That version now passes 8 of 12 tests, with the issue being the multiple
occurence of the same character in the answer being treated wrong, clearly an
edge case we were fortunate to identify early.
</p>

<p>
Looking at the tests, it seems that our scoring technique needs to remember how
many occurences of each characters of the answer exists, and grade only the
first occurence of such characters as &ldquo;wrong place&rdquo;, reducing the counter.
</p>

<p>
Fortunately, Python implements a good Counter function which we can import:
</p>

<div class="org-src-container">
<pre class="src src-python" id="orgbef0bec"><span style="color: #51afef;">from</span> collections <span style="color: #51afef;">import</span> Counter
</pre>
</div>

<p>
We want something like this:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #51afef;">if</span> guess_char <span style="color: #51afef;">in</span> answer_chars <span style="color: #51afef;">and</span> answer_chars<span style="color: #FF8811;">[</span>guess_char<span style="color: #FF8811;">]</span> &gt; <span style="color: #da8548; font-weight: bold;">0</span>:
    <span style="color: #dcaeea;">response</span> += WRONG_PLACE
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Reduce occurence since we "used" this one</span>
    <span style="color: #dcaeea;">answer_chars</span><span style="color: #FF8811;">[</span>guess_char<span style="color: #FF8811;">]</span> -= <span style="color: #da8548; font-weight: bold;">1</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">No more hits = pretend character isn't even seen (remove from dict)</span>
    <span style="color: #51afef;">if</span> answer_chars<span style="color: #FF8811;">[</span>guess_char<span style="color: #FF8811;">]</span> == <span style="color: #da8548; font-weight: bold;">0</span>:
        <span style="color: #51afef;">del</span> answer_chars<span style="color: #FF8811;">[</span>guess_char<span style="color: #FF8811;">]</span>
</pre>
</div>

<p>
So we try it
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 34: </span>Use a Counter for character multiple occurences</label><pre class="src src-python" id="orgbf63679"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">score_guess</span><span style="color: #FF8811;">(</span>guess: <span style="color: #c678dd;">str</span>, answer: <span style="color: #c678dd;">str</span><span style="color: #FF8811;">)</span> -&gt; <span style="color: #c678dd;">str</span>:
    <span style="color: #83898d;">"""Score an individual guess with Counter"""</span>
    <span style="color: #dcaeea;">NO</span> = <span style="color: #98be65;">"&#11036;"</span>
    <span style="color: #dcaeea;">OK</span> = <span style="color: #98be65;">"&#129001;"</span>
    <span style="color: #dcaeea;">WRONG_PLACE</span> = <span style="color: #98be65;">"&#129000;"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Counter("abbey") = Counter({'b': 2, 'a': 1, 'e': 1, 'y': 1})</span>
    <span style="color: #dcaeea;">answer_chars</span> = Counter<span style="color: #FF8811;">(</span>answer<span style="color: #FF8811;">)</span>
    <span style="color: #dcaeea;">response</span> = <span style="color: #98be65;">""</span>
    <span style="color: #51afef;">for</span> answer_char, guess_char <span style="color: #51afef;">in</span> <span style="color: #c678dd;">zip</span><span style="color: #FF8811;">(</span>answer, guess<span style="color: #FF8811;">)</span>:
        <span style="color: #51afef;">if</span> answer_char == guess_char:
            <span style="color: #dcaeea;">response</span> += OK
        <span style="color: #51afef;">elif</span> guess_char <span style="color: #51afef;">in</span> answer_chars <span style="color: #51afef;">and</span> answer_chars<span style="color: #FF8811;">[</span>guess_char<span style="color: #FF8811;">]</span> &gt; <span style="color: #da8548; font-weight: bold;">0</span>:
            <span style="color: #dcaeea;">response</span> += WRONG_PLACE
            <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Reduce occurence since we "used" this one</span>
            <span style="color: #dcaeea;">answer_chars</span><span style="color: #FF8811;">[</span>guess_char<span style="color: #FF8811;">]</span> -= <span style="color: #da8548; font-weight: bold;">1</span>
            <span style="color: #5B6268;"># </span><span style="color: #5B6268;">No more hits = pretend character isn't even seen (remove from dict)</span>
            <span style="color: #51afef;">if</span> answer_chars<span style="color: #FF8811;">[</span>guess_char<span style="color: #FF8811;">]</span> == <span style="color: #da8548; font-weight: bold;">0</span>:
                <span style="color: #51afef;">del</span> answer_chars<span style="color: #FF8811;">[</span>guess_char<span style="color: #FF8811;">]</span>
        <span style="color: #51afef;">else</span>:
            <span style="color: #dcaeea;">response</span> += NO
    <span style="color: #51afef;">return</span> response
</pre>
</div>

<p>
But while this improves the score, we are still 3 tests from success! Turns out
we only did the reduction of counter for yellow, not also greens. This needs a
bit of reshuffling:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 35: </span>Use a Counter for character multiple occurences</label><pre class="src src-python" id="org693d445"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">score_guess</span><span style="color: #FF8811;">(</span>guess: <span style="color: #c678dd;">str</span>, answer: <span style="color: #c678dd;">str</span><span style="color: #FF8811;">)</span> -&gt; <span style="color: #c678dd;">str</span>:
    <span style="color: #83898d;">"""Score an individual guess with Counter"""</span>
    <span style="color: #dcaeea;">NO</span> = <span style="color: #98be65;">"&#11036;"</span>
    <span style="color: #dcaeea;">OK</span> = <span style="color: #98be65;">"&#129001;"</span>
    <span style="color: #dcaeea;">WRONG_PLACE</span> = <span style="color: #98be65;">"&#129000;"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Counter("abbey") = Counter({'b': 2, 'a': 1, 'e': 1, 'y': 1})</span>
    <span style="color: #dcaeea;">answer_chars</span> = Counter<span style="color: #FF8811;">(</span>answer<span style="color: #FF8811;">)</span>
    <span style="color: #dcaeea;">response</span> = <span style="color: #98be65;">""</span>
    <span style="color: #51afef;">for</span> guess_char, answer_char <span style="color: #51afef;">in</span> <span style="color: #c678dd;">zip</span><span style="color: #FF8811;">(</span>guess, answer<span style="color: #FF8811;">)</span>:
        <span style="color: #51afef;">if</span> guess_char <span style="color: #51afef;">not</span> <span style="color: #51afef;">in</span> answer_chars:
            <span style="color: #dcaeea;">response</span> += NO
            <span style="color: #51afef;">continue</span>  <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Early exit for this character, skip to next</span>
        <span style="color: #5B6268;"># </span><span style="color: #5B6268;">From here on, we MUST have a char in common, regardless of place</span>
        <span style="color: #51afef;">if</span> answer_char == guess_char:
            <span style="color: #dcaeea;">response</span> += OK
        <span style="color: #51afef;">elif</span> answer_chars<span style="color: #FF8811;">[</span>guess_char<span style="color: #FF8811;">]</span> &gt; <span style="color: #da8548; font-weight: bold;">0</span>:
            <span style="color: #dcaeea;">response</span> += WRONG_PLACE
        <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Either way, reduce occurence counter since we "used" this occurence</span>
        <span style="color: #dcaeea;">answer_chars</span><span style="color: #FF8811;">[</span>guess_char<span style="color: #FF8811;">]</span> -= <span style="color: #da8548; font-weight: bold;">1</span>
        <span style="color: #5B6268;"># </span><span style="color: #5B6268;">No more hits = pretend character isn't even seen (remove from dict)</span>
        <span style="color: #51afef;">if</span> answer_chars<span style="color: #FF8811;">[</span>guess_char<span style="color: #FF8811;">]</span> == <span style="color: #da8548; font-weight: bold;">0</span>:
            <span style="color: #51afef;">del</span> answer_chars<span style="color: #FF8811;">[</span>guess_char<span style="color: #FF8811;">]</span>
    <span style="color: #51afef;">return</span> response
</pre>
</div>
</div>
</div>


<div id="outline-container-org437d242" class="outline-3">
<h3 id="org437d242"><span class="section-number-3">3.6.</span> Tangle it all out</h3>
<div class="outline-text-3" id="text-3-6">
<p>
Reorder the blocks from above to export with formatting enabled:
</p>
<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 36: </span>guess.py</label><pre class="src src-python" id="orgeb54b69"><span style="color: #83898d;">"""Score guesses of Wordle game"""</span>


<span style="color: #51afef;">from</span> collections <span style="color: #51afef;">import</span> Counter


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">score_guess</span><span style="color: #FF8811;">(</span>guess: <span style="color: #c678dd;">str</span>, answer: <span style="color: #c678dd;">str</span><span style="color: #FF8811;">)</span> -&gt; <span style="color: #c678dd;">str</span>:
    <span style="color: #83898d;">"""Score an individual guess with Counter"""</span>
    <span style="color: #dcaeea;">NO</span> = <span style="color: #98be65;">"&#11036;"</span>
    <span style="color: #dcaeea;">OK</span> = <span style="color: #98be65;">"&#129001;"</span>
    <span style="color: #dcaeea;">WRONG_PLACE</span> = <span style="color: #98be65;">"&#129000;"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Counter("abbey") = Counter({'b': 2, 'a': 1, 'e': 1, 'y': 1})</span>
    <span style="color: #dcaeea;">answer_chars</span> = Counter<span style="color: #FF8811;">(</span>answer<span style="color: #FF8811;">)</span>
    <span style="color: #dcaeea;">response</span> = <span style="color: #98be65;">""</span>
    <span style="color: #51afef;">for</span> guess_char, answer_char <span style="color: #51afef;">in</span> <span style="color: #c678dd;">zip</span><span style="color: #FF8811;">(</span>guess, answer<span style="color: #FF8811;">)</span>:
        <span style="color: #51afef;">if</span> guess_char <span style="color: #51afef;">not</span> <span style="color: #51afef;">in</span> answer_chars:
            <span style="color: #dcaeea;">response</span> += NO
            <span style="color: #51afef;">continue</span>  <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Early exit for this character, skip to next</span>
        <span style="color: #5B6268;"># </span><span style="color: #5B6268;">From here on, we MUST have a char in common, regardless of place</span>
        <span style="color: #51afef;">if</span> answer_char == guess_char:
            <span style="color: #dcaeea;">response</span> += OK
        <span style="color: #51afef;">elif</span> answer_chars<span style="color: #FF8811;">[</span>guess_char<span style="color: #FF8811;">]</span> &gt; <span style="color: #da8548; font-weight: bold;">0</span>:
            <span style="color: #dcaeea;">response</span> += WRONG_PLACE
        <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Either way, reduce occurence counter since we "used" this occurence</span>
        <span style="color: #dcaeea;">answer_chars</span><span style="color: #FF8811;">[</span>guess_char<span style="color: #FF8811;">]</span> -= <span style="color: #da8548; font-weight: bold;">1</span>
        <span style="color: #5B6268;"># </span><span style="color: #5B6268;">No more hits = pretend character isn't even seen (remove from dict)</span>
        <span style="color: #51afef;">if</span> answer_chars<span style="color: #FF8811;">[</span>guess_char<span style="color: #FF8811;">]</span> == <span style="color: #da8548; font-weight: bold;">0</span>:
            <span style="color: #51afef;">del</span> answer_chars<span style="color: #FF8811;">[</span>guess_char<span style="color: #FF8811;">]</span>
    <span style="color: #51afef;">return</span> response
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 37: </span>The tests</label><pre class="src src-python" id="orgc28ac8a"><span style="color: #83898d;">"""Validates the Gherkin file features/scoring_guess.feature:</span>

<span style="color: #83898d;">Feature: Scoring guesses</span>
<span style="color: #83898d;">  As a Wordle game</span>
<span style="color: #83898d;">  I need to tell the player how good their guess is</span>
<span style="color: #83898d;">  In order to help them find the proper answer</span>
<span style="color: #83898d;">"""</span>

<span style="color: #51afef;">import</span> pytest

<span style="color: #51afef;">from</span> literate_wordle.guess <span style="color: #51afef;">import</span> score_guess


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_perfect_guess</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: Perfect guess gives perfect score"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Given a wordle answer "crane"</span>
    <span style="color: #dcaeea;">answer</span> = <span style="color: #98be65;">"crane"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When scoring the guess "crane"</span>
    <span style="color: #dcaeea;">our_guess</span> = <span style="color: #98be65;">"crane"</span>
    <span style="color: #dcaeea;">score</span> = score_guess<span style="color: #FF8811;">(</span>our_guess, answer<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then score should be "&#129001;&#129001;&#129001;&#129001;&#129001;"</span>
    <span style="color: #51afef;">assert</span> score == <span style="color: #98be65;">"&#129001;&#129001;&#129001;&#129001;&#129001;"</span>, <span style="color: #98be65;">"Perfect answer should give Perfect Score"</span>


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_no_common_character</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: No character in common"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Given a wordle answer "brave"</span>
    <span style="color: #dcaeea;">answer</span> = <span style="color: #98be65;">"brave"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When scoring the guess "skill"</span>
    <span style="color: #dcaeea;">our_guess</span> = <span style="color: #98be65;">"skill"</span>
    <span style="color: #dcaeea;">score</span> = score_guess<span style="color: #FF8811;">(</span>our_guess, answer<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then score should be "&#11036;&#11036;&#11036;&#11036;&#11036;"</span>
    <span style="color: #51afef;">assert</span> score == <span style="color: #98be65;">"&#11036;&#11036;&#11036;&#11036;&#11036;"</span>, <span style="color: #98be65;">"No character in common with answer should give 0 score"</span>


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_wrong_place</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: Character in wrong place"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Given a wordle answer "rebus"</span>
    <span style="color: #dcaeea;">answer</span> = <span style="color: #98be65;">"rebus"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When scoring the guess "skull"</span>
    <span style="color: #dcaeea;">our_guess</span> = <span style="color: #98be65;">"skull"</span>
    <span style="color: #dcaeea;">score</span> = score_guess<span style="color: #FF8811;">(</span>our_guess, answer<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then score should be "&#129000;&#11036;&#129000;&#11036;&#11036;"</span>
    <span style="color: #51afef;">assert</span> score == <span style="color: #98be65;">"&#129000;&#11036;&#129000;&#11036;&#11036;"</span>, <span style="color: #98be65;">"Characters are in the wrong place"</span>


<span style="color: #ECBE7B;">@pytest.mark.parametrize</span><span style="color: #FF8811;">(</span>
    <span style="color: #98be65;">"answer,our_guess,expected_score"</span>,
    <span style="color: #8F0;">[</span>
        pytest.param<span style="color: #55DDFF;">(</span><span style="color: #98be65;">"adage"</span>, <span style="color: #98be65;">"adobe"</span>, <span style="color: #98be65;">"&#129001;&#129001;&#11036;&#11036;&#129001;"</span>, <span style="color: #c678dd;">id</span>=<span style="color: #98be65;">"normal_guess1"</span><span style="color: #55DDFF;">)</span>,
        pytest.param<span style="color: #55DDFF;">(</span><span style="color: #98be65;">"serif"</span>, <span style="color: #98be65;">"quiet"</span>, <span style="color: #98be65;">"&#11036;&#11036;&#129000;&#129000;&#11036;"</span>, <span style="color: #c678dd;">id</span>=<span style="color: #98be65;">"normal_guess2"</span><span style="color: #55DDFF;">)</span>,
        pytest.param<span style="color: #55DDFF;">(</span><span style="color: #98be65;">"raise"</span>, <span style="color: #98be65;">"radix"</span>, <span style="color: #98be65;">"&#129001;&#129001;&#11036;&#129000;&#11036;"</span>, <span style="color: #c678dd;">id</span>=<span style="color: #98be65;">"normal_guess3"</span><span style="color: #55DDFF;">)</span>,
        pytest.param<span style="color: #55DDFF;">(</span><span style="color: #98be65;">"abbey"</span>, <span style="color: #98be65;">"kebab"</span>, <span style="color: #98be65;">"&#11036;&#129000;&#129001;&#129000;&#129000;"</span>, <span style="color: #c678dd;">id</span>=<span style="color: #98be65;">"multi_occur1"</span><span style="color: #55DDFF;">)</span>,
        pytest.param<span style="color: #55DDFF;">(</span><span style="color: #98be65;">"abbey"</span>, <span style="color: #98be65;">"babes"</span>, <span style="color: #98be65;">"&#129000;&#129000;&#129001;&#129001;&#11036;"</span>, <span style="color: #c678dd;">id</span>=<span style="color: #98be65;">"multi_occur2"</span><span style="color: #55DDFF;">)</span>,
        pytest.param<span style="color: #55DDFF;">(</span><span style="color: #98be65;">"abbey"</span>, <span style="color: #98be65;">"abyss"</span>, <span style="color: #98be65;">"&#129001;&#129001;&#129000;&#11036;&#11036;"</span>, <span style="color: #c678dd;">id</span>=<span style="color: #98be65;">"multi_occur3"</span><span style="color: #55DDFF;">)</span>,
        pytest.param<span style="color: #55DDFF;">(</span><span style="color: #98be65;">"abbey"</span>, <span style="color: #98be65;">"algae"</span>, <span style="color: #98be65;">"&#129001;&#11036;&#11036;&#11036;&#129000;"</span>, <span style="color: #c678dd;">id</span>=<span style="color: #98be65;">"multi_occur4"</span><span style="color: #55DDFF;">)</span>,
        pytest.param<span style="color: #55DDFF;">(</span><span style="color: #98be65;">"abbey"</span>, <span style="color: #98be65;">"keeps"</span>, <span style="color: #98be65;">"&#11036;&#129000;&#11036;&#11036;&#11036;"</span>, <span style="color: #c678dd;">id</span>=<span style="color: #98be65;">"multi_occur5"</span><span style="color: #55DDFF;">)</span>,
        pytest.param<span style="color: #55DDFF;">(</span><span style="color: #98be65;">"abbey"</span>, <span style="color: #98be65;">"abate"</span>, <span style="color: #98be65;">"&#129001;&#129001;&#11036;&#11036;&#129000;"</span>, <span style="color: #c678dd;">id</span>=<span style="color: #98be65;">"multi_occur6"</span><span style="color: #55DDFF;">)</span>,
    <span style="color: #8F0;">]</span>,
<span style="color: #FF8811;">)</span>
<span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_generic_score</span><span style="color: #FF8811;">(</span>answer, our_guess, expected_score<span style="color: #FF8811;">)</span>:
    <span style="color: #83898d;">"""Scenario Outline: Scoring guesses"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Given a wordle &lt;answer&gt;</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When scoring &lt;guess&gt;</span>
    <span style="color: #dcaeea;">score</span> = score_guess<span style="color: #FF8811;">(</span>our_guess, answer<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then score should be &lt;score&gt;</span>
    <span style="color: #51afef;">assert</span> score == expected_score
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org77562de" class="outline-2">
<h2 id="org77562de"><span class="section-number-2">4.</span> Playing a round of Wordle</h2>
<div class="outline-text-2" id="text-4">
<p>
With all the subfeatures we have, we can now play a round of wordle, we&rsquo;re
missing only the &ldquo;state&rdquo; of the game board, with the interactivity of the game.
</p>

<div class="org-src-container">
<pre class="src src-feature" id="org6874501"><span style="color: #51afef;">Feature:</span><span style="color: #ECBE7B;"> Track number of guesses</span>
  As a Wordle game
  I need to track how many guesses were already given
  In order to announce win or game over
</pre>
</div>

<p>
There are a few obvious cases we want to see:
</p>

<div class="org-src-container">
<pre class="src src-feature" id="orgb0dba4f"><span style="color: #51afef;">Scenario:</span><span style="color: #c678dd;"> First guess is allowed</span>
<span style="color: #51afef;">  Given</span> a wordle answer
<span style="color: #51afef;">  And</span> I didn't guess before
<span style="color: #51afef;">  When</span> I guess the word
<span style="color: #51afef;">  Then</span> my guess is scored
</pre>
</div>


<div class="org-src-container">
<pre class="src src-feature" id="org1ae45d1"><span style="color: #51afef;">Scenario:</span><span style="color: #c678dd;"> Fifth guess still allowed</span>
<span style="color: #51afef;">  Given</span> a wordle answer
<span style="color: #51afef;">  And</span> I guessed 4 times
<span style="color: #51afef;">  When</span> I guess the word
<span style="color: #51afef;">  Then</span> my guess is scored
</pre>
</div>


<div class="org-src-container">
<pre class="src src-feature" id="orge793f3d"><span style="color: #51afef;">Scenario:</span><span style="color: #c678dd;"> Six failed guess is game over</span>
<span style="color: #51afef;">  Given</span> a wordle answer
<span style="color: #51afef;">  And</span> I guessed 6 times already
<span style="color: #51afef;">  When</span> I guess the word
<span style="color: #51afef;">  And</span> my guess isn't the answer
<span style="color: #51afef;">  Then</span> my guess is scored
<span style="color: #51afef;">  But</span> game shows <span style="color: #98be65;">"Game Over"</span>
<span style="color: #51afef;">  And</span> game shows the real answer
</pre>
</div>

<p>
This feature shows us all the state we need to manage to track a Wordle game:
</p>
<ul class="org-ul">
<li>an answer</li>
<li>the number of previous guesses</li>
<li>the previous guesses themselves? not needed after we print</li>
<li>the previous guesses&rsquo; scores? not needed after we print it either</li>
</ul>

<p>
Simply answer + number of guesses then.
</p>

<p>
Let&rsquo;s test it out: New test file, with docstring from Gherkin Feature.
</p>

<div class="org-src-container">
<pre class="src src-python" id="orga262df4"><span style="color: #83898d;">"""Validates the Gherkin file features/track_guesses.feature</span>

<span style="color: #83898d;">Feature: Track number of guesses</span>
<span style="color: #83898d;">  As a Wordle game</span>
<span style="color: #83898d;">  I need to track how many guesses were already given</span>
<span style="color: #83898d;">  In order to announce win or game over</span>
<span style="color: #83898d;">"""</span>
</pre>
</div>

<p>
In terms of the prototype of that function, it seems we need to track
separately:
</p>
<ul class="org-ul">
<li>The game&rsquo;s internal state, before a move is played</li>
<li>The different outcomes that a guess can have (win, loose, continue)</li>
<li>Result of a guess on a game</li>
</ul>

<p>
This will mean some data structures (maybe a little overkill, but fun!):
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 38: </span>Imports for enumeration of state and data-holding classes</label><pre class="src src-python" id="org1959622"><span style="color: #51afef;">from</span> dataclasses <span style="color: #51afef;">import</span> dataclass
<span style="color: #51afef;">from</span> enum <span style="color: #51afef;">import</span> Enum
<span style="color: #51afef;">from</span> typing <span style="color: #51afef;">import</span> Optional
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 39: </span>Enum for outcomes of a single move</label><pre class="src src-python" id="orgb2d236b"><span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">WordleMoveOutcome</span><span style="color: #FF8811;">(</span>Enum<span style="color: #FF8811;">)</span>:
    <span style="color: #83898d;">"""Outcome of a single move"""</span>

    <span style="color: #dcaeea;">GAME_OVER_LOST</span> = <span style="color: #da8548; font-weight: bold;">1</span>
    <span style="color: #dcaeea;">GAME_WON</span> = <span style="color: #da8548; font-weight: bold;">2</span>
    <span style="color: #dcaeea;">GUESS_SCORED_CONTINUE</span> = <span style="color: #da8548; font-weight: bold;">3</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 40: </span>Objects necessary to keep state of the game</label><pre class="src src-python" id="orga74a6c3"><span style="color: #ECBE7B;">@dataclass</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">WordleGame</span>:
    <span style="color: #83898d;">"""A Wordle game's internal state, before a move is played"""</span>

    answer: <span style="color: #c678dd;">str</span>
    guess_number: <span style="color: #c678dd;">int</span>


<span style="color: #ECBE7B;">@dataclass</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">WordleMove</span>:
    <span style="color: #83898d;">"""A Wordle game state once a move is played"""</span>

    game: WordleGame
    outcome: WordleMoveOutcome
    message: <span style="color: #c678dd;">str</span>
    score: Optional<span style="color: #FF8811;">[</span><span style="color: #c678dd;">str</span><span style="color: #FF8811;">]</span>
</pre>
</div>

<p>
So we can now define our function:
</p>

<div class="org-src-container">
<pre class="src src-python" id="orge55d222"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">play_round</span><span style="color: #FF8811;">(</span>guess: <span style="color: #c678dd;">str</span>, game: WordleGame<span style="color: #FF8811;">)</span> -&gt; WordleMove:
    <span style="color: #83898d;">"""Use guess on the given game, resulting in WordleMove"""</span>
</pre>
</div>


<p>
Before we finish implementing this function, let&rsquo;s define its acceptance tests:
</p>


<div class="org-src-container">
<pre class="src src-python" id="orgb1f61d6"><span style="color: #51afef;">from</span> literate_wordle.game <span style="color: #51afef;">import</span> WordleGame, WordleMoveOutcome, play_round
</pre>
</div>



<div class="org-src-container">
<pre class="src src-python" id="org86f5dbe"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_first_guess_allowed</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: First guess is allowed"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Given a wordle answer</span>
    <span style="color: #dcaeea;">answer</span> = <span style="color: #98be65;">"orbit"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And I didn't guess before</span>
    <span style="color: #dcaeea;">guess_number</span> = <span style="color: #da8548; font-weight: bold;">0</span>
    <span style="color: #dcaeea;">game</span> = WordleGame<span style="color: #FF8811;">(</span>answer=answer, guess_number=guess_number<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When I guess the word</span>
    <span style="color: #dcaeea;">guess</span> = <span style="color: #98be65;">"kebab"</span>
    <span style="color: #dcaeea;">result</span> = play_round<span style="color: #FF8811;">(</span>guess, game<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then my guess is scored</span>
    <span style="color: #dcaeea;">OUTCOME_CONTINUE</span> = WordleMoveOutcome.GUESS_SCORED_CONTINUE
    <span style="color: #51afef;">assert</span> result.outcome == OUTCOME_CONTINUE, <span style="color: #98be65;">"Game shouldn't be over yet"</span>
    <span style="color: #51afef;">assert</span> result.score <span style="color: #51afef;">is</span> <span style="color: #51afef;">not</span> <span style="color: #a9a1e1;">None</span>, <span style="color: #98be65;">"No score given as result"</span>
    <span style="color: #51afef;">assert</span> <span style="color: #c678dd;">len</span><span style="color: #FF8811;">(</span>result.score<span style="color: #FF8811;">)</span> == <span style="color: #da8548; font-weight: bold;">5</span>, <span style="color: #98be65;">"Score of incorrect length"</span>
    <span style="color: #dcaeea;">OK_CHARS</span> = <span style="color: #FF8811;">[</span><span style="color: #98be65;">"&#129001;"</span>, <span style="color: #98be65;">"&#129000;"</span>, <span style="color: #98be65;">"&#11036;"</span><span style="color: #FF8811;">]</span>
    <span style="color: #51afef;">assert</span> <span style="color: #c678dd;">all</span><span style="color: #FF8811;">(</span>
        char <span style="color: #51afef;">in</span> OK_CHARS <span style="color: #51afef;">for</span> char <span style="color: #51afef;">in</span> <span style="color: #c678dd;">list</span><span style="color: #8F0;">(</span>result.score<span style="color: #8F0;">)</span>
    <span style="color: #FF8811;">)</span>, <span style="color: #98be65;">"Score doesn't match score's characters"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python" id="orgcd9cce0"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_fifth_guess_allowed</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: Fifth guess still allowed"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Given a wordle answer</span>
    <span style="color: #dcaeea;">answer</span> = <span style="color: #98be65;">"orbit"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And I guessed 4 times</span>
    <span style="color: #dcaeea;">guess_number</span> = <span style="color: #da8548; font-weight: bold;">4</span>
    <span style="color: #dcaeea;">game</span> = WordleGame<span style="color: #FF8811;">(</span>answer=answer, guess_number=guess_number<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When I guess the word</span>
    <span style="color: #dcaeea;">guess</span> = <span style="color: #98be65;">"kebab"</span>
    <span style="color: #dcaeea;">result</span> = play_round<span style="color: #FF8811;">(</span>guess, game<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then my guess is scored</span>
    <span style="color: #dcaeea;">OUTCOME_CONTINUE</span> = WordleMoveOutcome.GUESS_SCORED_CONTINUE
    <span style="color: #51afef;">assert</span> result.outcome == OUTCOME_CONTINUE, <span style="color: #98be65;">"Game shouldn't be over yet"</span>
    <span style="color: #51afef;">assert</span> result.score <span style="color: #51afef;">is</span> <span style="color: #51afef;">not</span> <span style="color: #a9a1e1;">None</span>, <span style="color: #98be65;">"No score given as result"</span>
    <span style="color: #51afef;">assert</span> <span style="color: #c678dd;">len</span><span style="color: #FF8811;">(</span>result.score<span style="color: #FF8811;">)</span> == <span style="color: #da8548; font-weight: bold;">5</span>, <span style="color: #98be65;">"Score of incorrect length"</span>
    <span style="color: #dcaeea;">OK_CHARS</span> = <span style="color: #FF8811;">[</span><span style="color: #98be65;">"&#129001;"</span>, <span style="color: #98be65;">"&#129000;"</span>, <span style="color: #98be65;">"&#11036;"</span><span style="color: #FF8811;">]</span>
    <span style="color: #51afef;">assert</span> <span style="color: #c678dd;">all</span><span style="color: #FF8811;">(</span>
        char <span style="color: #51afef;">in</span> OK_CHARS <span style="color: #51afef;">for</span> char <span style="color: #51afef;">in</span> <span style="color: #c678dd;">list</span><span style="color: #8F0;">(</span>result.score<span style="color: #8F0;">)</span>
    <span style="color: #FF8811;">)</span>, <span style="color: #98be65;">"Score doesn't match score's characters"</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-python" id="org12c1a78"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_sixth_guess_fails_game</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: Sixth failed guess is game over"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Given a wordle answer</span>
    <span style="color: #dcaeea;">answer</span> = <span style="color: #98be65;">"orbit"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And I guessed 6 times already</span>
    <span style="color: #dcaeea;">guess_number</span> = <span style="color: #da8548; font-weight: bold;">6</span>
    <span style="color: #dcaeea;">game</span> = WordleGame<span style="color: #FF8811;">(</span>answer, guess_number<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When I guess the word</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And my guess isn't the answer</span>
    <span style="color: #dcaeea;">guess</span> = <span style="color: #98be65;">"kebab"</span>
    <span style="color: #dcaeea;">result</span> = play_round<span style="color: #FF8811;">(</span>guess, game<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then my guess isn't scored</span>
    <span style="color: #51afef;">assert</span> result.outcome == WordleMoveOutcome.GAME_OVER_LOST, <span style="color: #98be65;">"Should have lost game"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">But game shows "Game Over"</span>
    <span style="color: #51afef;">assert</span> <span style="color: #98be65;">"game over"</span> <span style="color: #51afef;">in</span> result.message.lower<span style="color: #FF8811;">()</span>, <span style="color: #98be65;">"Should show game over message"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And game shows the real answer</span>
    <span style="color: #51afef;">assert</span> answer <span style="color: #51afef;">in</span> result.message
</pre>
</div>

<p>
As I write this test, I notice there&rsquo;s one case of the <code>enum</code> we haven&rsquo;t
covered, which means the <code>play_round</code> scenarios aren&rsquo;t correct. Let&rsquo;s add a
scenario for winning the game!
</p>

<div class="org-src-container">
<pre class="src src-feature" id="org47d63d6"><span style="color: #51afef;">Scenario:</span><span style="color: #c678dd;"> Winning guess</span>
<span style="color: #51afef;">  Given</span> a wordle answer
<span style="color: #51afef;">  And</span> I guessed 3 times
<span style="color: #51afef;">  When</span> I guess the word
<span style="color: #51afef;">  And</span> my guess is the answer
<span style="color: #51afef;">  Then</span> my guess is scored
<span style="color: #51afef;">  And</span> score is perfect
<span style="color: #51afef;">  And</span> game shows <span style="color: #98be65;">"Game Won"</span>
</pre>
</div>

<p>
Accordingly, we write a test:
</p>

<div class="org-src-container">
<pre class="src src-python" id="org0d431f5"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_winning_guess_wins</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: Winning guess"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Given a wordle answer</span>
    <span style="color: #dcaeea;">answer</span> = <span style="color: #98be65;">"orbit"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And I guessed 3 times</span>
    <span style="color: #dcaeea;">guess_number</span> = <span style="color: #da8548; font-weight: bold;">3</span>
    <span style="color: #dcaeea;">game</span> = WordleGame<span style="color: #FF8811;">(</span>answer, guess_number<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When I guess the word</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And my guess is the answer</span>
    <span style="color: #dcaeea;">guess</span> = answer
    <span style="color: #dcaeea;">result</span> = play_round<span style="color: #FF8811;">(</span>guess, game<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then my guess is scored</span>
    <span style="color: #51afef;">assert</span> result.score <span style="color: #51afef;">is</span> <span style="color: #51afef;">not</span> <span style="color: #a9a1e1;">None</span>, <span style="color: #98be65;">"Guess should be scored"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And the score is perfect</span>
    <span style="color: #51afef;">assert</span> result.score == <span style="color: #98be65;">"&#129001;&#129001;&#129001;&#129001;&#129001;"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And game shows "Game Won</span>
    <span style="color: #51afef;">assert</span> result.outcome == WordleMoveOutcome.GAME_WON, <span style="color: #98be65;">"Should have won game"</span>
    <span style="color: #51afef;">assert</span> <span style="color: #98be65;">"game won"</span> <span style="color: #51afef;">in</span> result.message.lower<span style="color: #FF8811;">()</span>
</pre>
</div>

<p>
With all the tests in hand, we tangle everything out into files, filling in a
dummy prototype for the benefit of red tests.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 41: </span>A dummy move result to make tests run but fail</label><pre class="src src-python" id="orgfa96579"><span style="color: #dcaeea;">result</span> = WordleMoveOutcome.GAME_OVER_LOST
<span style="color: #51afef;">return</span> WordleMove<span style="color: #FF8811;">(</span>game=game, outcome=result, message=<span style="color: #98be65;">"You suck!"</span>, score=<span style="color: #a9a1e1;">None</span><span style="color: #FF8811;">)</span>
</pre>
</div>

<p>
All right, the tests do fail, right?
</p>

<div class="org-src-container">
<pre class="src src-shell">poetry run pytest <span style="color: #da8548; font-weight: bold;">2</span>&gt;&amp;<span style="color: #da8548; font-weight: bold;">1</span> || true
</pre>
</div>

<p>
All right, let&rsquo;s implement this:
</p>
</div>
<div id="outline-container-orgf59ce5b" class="outline-3">
<h3 id="orgf59ce5b"><span class="section-number-3">4.1.</span> Implementing the feature</h3>
<div class="outline-text-3" id="text-4-1">
<p>
First, if we have too many guesses already (before this one), we return game
lost. This means we decide to fail not at the end of the failed fifth guess, but
beginning of the sixth.
</p>

<div class="org-src-container">
<pre class="src src-python" id="org533b74c"><span style="color: #51afef;">if</span> game.guess_number &gt;= <span style="color: #da8548; font-weight: bold;">6</span>:
    <span style="color: #dcaeea;">message</span> = f<span style="color: #98be65;">"Too many guesses: Game Over. Answer was: {game.answer}"</span>
    <span style="color: #dcaeea;">outcome</span> = WordleMoveOutcome.GAME_OVER_LOST
    <span style="color: #51afef;">return</span> WordleMove<span style="color: #FF8811;">(</span>game=game, outcome=outcome, message=message, score=<span style="color: #a9a1e1;">None</span><span style="color: #FF8811;">)</span>
</pre>
</div>

<p>
In order to count a guess, it needs to be a valid word. This means importing
some of our local module.
</p>

<div class="org-src-container">
<pre class="src src-python" id="org5200308"><span style="color: #51afef;">from</span> literate_wordle.guess <span style="color: #51afef;">import</span> score_guess
<span style="color: #51afef;">from</span> literate_wordle.words <span style="color: #51afef;">import</span> check_valid_word
</pre>
</div>

<p>
As we try to design this code block, we notice that if the word isn&rsquo;t valid, we
can&rsquo;t return <code>GUESS_SCORED_CONTINUE</code>, because an invalid guess can&rsquo;t be counted!
So we revise the enum for <code>WordleMoveOutcome</code> and because it&rsquo;s a new enum case, we
will need to add a test for it to cover all grounds! Let&rsquo;s put a pin in that,
finish implementing this first.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 42: </span>Fourth possibility: guess wasn&rsquo;t valid, not counted</label><pre class="src src-python" id="org8ad6d1d"><span style="color: #dcaeea;">GUESS_NOTVALID_CONTINUE</span> = <span style="color: #da8548; font-weight: bold;">4</span>
</pre>
</div>

<p>
To compensate for having this enum defined all out of order, we&rsquo;ll use the
&ldquo;noweb&rdquo; feature of org-mode to weave code, in subsection below, inserting this
fourth possibility in the correct place, so the code looks legit.
</p>

<div class="org-src-container">
<pre class="src src-python" id="org9a64614"><span style="color: #dcaeea;">valid</span>, <span style="color: #dcaeea;">validity_msg</span> = check_valid_word<span style="color: #FF8811;">(</span>guess<span style="color: #FF8811;">)</span>
<span style="color: #51afef;">if</span> <span style="color: #51afef;">not</span> valid <span style="color: #51afef;">and</span> validity_msg <span style="color: #51afef;">is</span> <span style="color: #51afef;">not</span> <span style="color: #a9a1e1;">None</span>:
    <span style="color: #dcaeea;">outcome</span> = WordleMoveOutcome.GUESS_NOTVALID_CONTINUE
    <span style="color: #51afef;">return</span> WordleMove<span style="color: #FF8811;">(</span>game=game, outcome=outcome, message=validity_msg, score=<span style="color: #a9a1e1;">None</span><span style="color: #FF8811;">)</span>
</pre>
</div>

<p>
Now we&rsquo;ve gotten rid of the cases where the guess was invalid, we&rsquo;re
interpreting this guess, which means counting it, incrementing guess number:
</p>

<div class="org-src-container">
<pre class="src src-python" id="org898b8d8"><span style="color: #5B6268;"># </span><span style="color: #5B6268;">Guess now guaranteed to be valid: count it</span>
<span style="color: #dcaeea;">game.guess_number</span> += <span style="color: #da8548; font-weight: bold;">1</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 43: </span>The now-valid guess, should be scored</label><pre class="src src-python" id="orgd812344"><span style="color: #dcaeea;">score</span> = score_guess<span style="color: #FF8811;">(</span>guess, game.answer<span style="color: #FF8811;">)</span>
</pre>
</div>


<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 44: </span>With a valid guess, can it be won?</label><pre class="src src-python" id="org800b8f1"><span style="color: #51afef;">if</span> score == <span style="color: #98be65;">"&#129001;&#129001;&#129001;&#129001;&#129001;"</span>:
    <span style="color: #dcaeea;">outcome</span> = WordleMoveOutcome.GAME_WON
    <span style="color: #dcaeea;">message</span> = f<span style="color: #98be65;">"Correct! Game won in {game.guess_number - 1} guesses"</span>
    <span style="color: #51afef;">return</span> WordleMove<span style="color: #FF8811;">(</span>game=game, outcome=outcome, message=message, score=score<span style="color: #FF8811;">)</span>
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 45: </span>Last possibility remains: scored, try another guess</label><pre class="src src-python" id="org83f2491"><span style="color: #5B6268;"># </span><span style="color: #5B6268;">Only case left is "try another guess"</span>
<span style="color: #dcaeea;">outcome</span> = WordleMoveOutcome.GUESS_SCORED_CONTINUE
<span style="color: #dcaeea;">message</span> = f<span style="color: #98be65;">"Try again! Guess number {game.guess_number - 1}. Score is: {score}"</span>
<span style="color: #51afef;">return</span> WordleMove<span style="color: #FF8811;">(</span>game=game, outcome=outcome, message=message, score=score<span style="color: #FF8811;">)</span>
</pre>
</div>



<p>
Note that throughout this codebase, we made a lot of assumptions and repetitions
around the length of a Wordle answer/guess, and this translate to repeated
hardcoded-ness like above These could have been addressed right away during
implementation, but it&rsquo;s important to consider if the scope increase is worth
it: generalized Wordle to N characters isn&rsquo;t super interesting to me, as it
would require cutting new dictionaries, etc, and I&rsquo;m just not that into Wordle.
This is the kind of technical design decision we can do by having a firm grasp
on project scope, another advantage of deep understanding of project requirements.
</p>

<p>
Back to the implementation: tests should all pass now, <code>make</code> is happy, but
there&rsquo;s an interesting issue:
</p>

<div class="verbatim" id="orgce9e776">
<p>
------&#x2013;&#x2014; coverage: platform linux, python 3.9.5-final-0 ------&#x2013;&#x2014;
Name                                     Stmts   Miss  Cover
</p>
<hr />
<p>
src/literate_wordle/__init__.py              1      0   100%
src/literate_wordle/assets/__init__.py       0      0   100%
src/literate_wordle/game.py                 38      2    95%
src/literate_wordle/guess.py                19      0   100%
src/literate_wordle/words.py                25      0   100%
</p>
<hr />
<p>
TOTAL                                       83      2    98%
Coverage HTML written to dir test_results/coverage.html
Coverage XML written to file test_results/coverage.xml
</p>

</div>

<p>
We lowered coverage, nooo! Exploring the coverage HTML file in a browser, we see
that the lines in question that aren&rsquo;t covered are:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #51afef;">if</span> <span style="color: #51afef;">not</span> valid <span style="color: #51afef;">and</span> validity_msg <span style="color: #51afef;">is</span> <span style="color: #51afef;">not</span> <span style="color: #a9a1e1;">None</span>:
    <span style="color: #dcaeea;">outcome</span> = WordleMoveOutcome.GUESS_NOTVALID_CONTINUE
    <span style="color: #51afef;">return</span> WordleMove<span style="color: #FF8811;">(</span>game=game, outcome=outcome, message=validity_msg, score=<span style="color: #a9a1e1;">None</span><span style="color: #FF8811;">)</span>
</pre>
</div>

<p>
Oh! Well that&rsquo;s the test case we put a pin in! Cool, back to writing that test.
I wonder if we should write a whole scenario to back it up?
It&rsquo;s not really obvious! If this test case spins out of an edge case of our
implementation, it&rsquo;s not really coming from a business requirement, so it&rsquo;s
probably not worth writing a Gherkin Scenario alongside the other ones. If it is
indeed an overlooked requirement, then yes, add it to the pile.
Hmm, let&rsquo;s write the test, and see if the scenario it plays up is a
requirement.
</p>

<div class="org-src-container">
<pre class="src src-python" id="orgb298294"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_invalid_guess_not_counted</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: Invalid guess isn't counted"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Given a wordle answer</span>
    <span style="color: #dcaeea;">answer</span> = <span style="color: #98be65;">"orbit"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And I guessed 3 times</span>
    <span style="color: #dcaeea;">guess_number</span> = <span style="color: #da8548; font-weight: bold;">3</span>
    <span style="color: #dcaeea;">game</span> = WordleGame<span style="color: #FF8811;">(</span>answer=answer, guess_number=guess_number<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When I guess the word</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">But my guess isn't a dictionary word</span>
    <span style="color: #dcaeea;">guess</span> = <span style="color: #98be65;">"xolfy"</span>
    <span style="color: #dcaeea;">result</span> = play_round<span style="color: #FF8811;">(</span>guess, game<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then my guess is rejected as invalid word</span>
    <span style="color: #dcaeea;">OUTCOME_BADWORD</span> = WordleMoveOutcome.GUESS_NOTVALID_CONTINUE
    <span style="color: #51afef;">assert</span> result.outcome == OUTCOME_BADWORD, <span style="color: #98be65;">"Guess should have been rejected"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And my guess is not scored</span>
    <span style="color: #51afef;">assert</span> result.score <span style="color: #51afef;">is</span> <span style="color: #a9a1e1;">None</span>, <span style="color: #98be65;">"No score should be given on bad word"</span>
</pre>
</div>

<p>
Hmm, after some thought, it seems that the function we implemented, compared to the
feature being described in Gherkin, is different!
</p>

<p>
The Gherkin feature is about tracking specific number of guesses. But the
implemented feature is the wider &ldquo;play round&rdquo; feature, which indeed needs to
cover more cases than just how many guesses, it needs to understand that the
guess is correct or not.
</p>

<p>
So for the specific purpose of tracking guesses as a feature, we&rsquo;re already
covered by existing scenarios. But as we saw in coverage metrics, we&rsquo;re missing
some edge cases, which maybe a wider feature like &ldquo;play a round&rdquo; would cover.
</p>

<p>
This game&rsquo;s implementation being so very near completion, I am making the
decision to not split feature files, and simply consider the missing tests an
implementation detail, just to keep this narrative on track.
</p>

<p>
And with this new test, we&rsquo;re back to passing tests and 100% coverage!
</p>
</div>
</div>

<div id="outline-container-org8ebf31d" class="outline-3">
<h3 id="org8ebf31d"><span class="section-number-3">4.2.</span> Tangling out the whole thing</h3>
<div class="outline-text-3" id="text-4-2">
<p>
The tests:
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #83898d;">"""Validates the Gherkin file features/track_guesses.feature</span>

<span style="color: #83898d;">Feature: Track number of guesses</span>
<span style="color: #83898d;">  As a Wordle game</span>
<span style="color: #83898d;">  I need to track how many guesses were already given</span>
<span style="color: #83898d;">  In order to announce win or game over</span>
<span style="color: #83898d;">"""</span>


<span style="color: #51afef;">from</span> literate_wordle.game <span style="color: #51afef;">import</span> WordleGame, WordleMoveOutcome, play_round


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_first_guess_allowed</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: First guess is allowed"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Given a wordle answer</span>
    <span style="color: #dcaeea;">answer</span> = <span style="color: #98be65;">"orbit"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And I didn't guess before</span>
    <span style="color: #dcaeea;">guess_number</span> = <span style="color: #da8548; font-weight: bold;">0</span>
    <span style="color: #dcaeea;">game</span> = WordleGame<span style="color: #FF8811;">(</span>answer=answer, guess_number=guess_number<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When I guess the word</span>
    <span style="color: #dcaeea;">guess</span> = <span style="color: #98be65;">"kebab"</span>
    <span style="color: #dcaeea;">result</span> = play_round<span style="color: #FF8811;">(</span>guess, game<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then my guess is scored</span>
    <span style="color: #dcaeea;">OUTCOME_CONTINUE</span> = WordleMoveOutcome.GUESS_SCORED_CONTINUE
    <span style="color: #51afef;">assert</span> result.outcome == OUTCOME_CONTINUE, <span style="color: #98be65;">"Game shouldn't be over yet"</span>
    <span style="color: #51afef;">assert</span> result.score <span style="color: #51afef;">is</span> <span style="color: #51afef;">not</span> <span style="color: #a9a1e1;">None</span>, <span style="color: #98be65;">"No score given as result"</span>
    <span style="color: #51afef;">assert</span> <span style="color: #c678dd;">len</span><span style="color: #FF8811;">(</span>result.score<span style="color: #FF8811;">)</span> == <span style="color: #da8548; font-weight: bold;">5</span>, <span style="color: #98be65;">"Score of incorrect length"</span>
    <span style="color: #dcaeea;">OK_CHARS</span> = <span style="color: #FF8811;">[</span><span style="color: #98be65;">"&#129001;"</span>, <span style="color: #98be65;">"&#129000;"</span>, <span style="color: #98be65;">"&#11036;"</span><span style="color: #FF8811;">]</span>
    <span style="color: #51afef;">assert</span> <span style="color: #c678dd;">all</span><span style="color: #FF8811;">(</span>
        char <span style="color: #51afef;">in</span> OK_CHARS <span style="color: #51afef;">for</span> char <span style="color: #51afef;">in</span> <span style="color: #c678dd;">list</span><span style="color: #8F0;">(</span>result.score<span style="color: #8F0;">)</span>
    <span style="color: #FF8811;">)</span>, <span style="color: #98be65;">"Score doesn't match score's characters"</span>


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_fifth_guess_allowed</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: Fifth guess still allowed"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Given a wordle answer</span>
    <span style="color: #dcaeea;">answer</span> = <span style="color: #98be65;">"orbit"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And I guessed 4 times</span>
    <span style="color: #dcaeea;">guess_number</span> = <span style="color: #da8548; font-weight: bold;">4</span>
    <span style="color: #dcaeea;">game</span> = WordleGame<span style="color: #FF8811;">(</span>answer=answer, guess_number=guess_number<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When I guess the word</span>
    <span style="color: #dcaeea;">guess</span> = <span style="color: #98be65;">"kebab"</span>
    <span style="color: #dcaeea;">result</span> = play_round<span style="color: #FF8811;">(</span>guess, game<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then my guess is scored</span>
    <span style="color: #dcaeea;">OUTCOME_CONTINUE</span> = WordleMoveOutcome.GUESS_SCORED_CONTINUE
    <span style="color: #51afef;">assert</span> result.outcome == OUTCOME_CONTINUE, <span style="color: #98be65;">"Game shouldn't be over yet"</span>
    <span style="color: #51afef;">assert</span> result.score <span style="color: #51afef;">is</span> <span style="color: #51afef;">not</span> <span style="color: #a9a1e1;">None</span>, <span style="color: #98be65;">"No score given as result"</span>
    <span style="color: #51afef;">assert</span> <span style="color: #c678dd;">len</span><span style="color: #FF8811;">(</span>result.score<span style="color: #FF8811;">)</span> == <span style="color: #da8548; font-weight: bold;">5</span>, <span style="color: #98be65;">"Score of incorrect length"</span>
    <span style="color: #dcaeea;">OK_CHARS</span> = <span style="color: #FF8811;">[</span><span style="color: #98be65;">"&#129001;"</span>, <span style="color: #98be65;">"&#129000;"</span>, <span style="color: #98be65;">"&#11036;"</span><span style="color: #FF8811;">]</span>
    <span style="color: #51afef;">assert</span> <span style="color: #c678dd;">all</span><span style="color: #FF8811;">(</span>
        char <span style="color: #51afef;">in</span> OK_CHARS <span style="color: #51afef;">for</span> char <span style="color: #51afef;">in</span> <span style="color: #c678dd;">list</span><span style="color: #8F0;">(</span>result.score<span style="color: #8F0;">)</span>
    <span style="color: #FF8811;">)</span>, <span style="color: #98be65;">"Score doesn't match score's characters"</span>


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_sixth_guess_fails_game</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: Sixth failed guess is game over"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Given a wordle answer</span>
    <span style="color: #dcaeea;">answer</span> = <span style="color: #98be65;">"orbit"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And I guessed 6 times already</span>
    <span style="color: #dcaeea;">guess_number</span> = <span style="color: #da8548; font-weight: bold;">6</span>
    <span style="color: #dcaeea;">game</span> = WordleGame<span style="color: #FF8811;">(</span>answer, guess_number<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When I guess the word</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And my guess isn't the answer</span>
    <span style="color: #dcaeea;">guess</span> = <span style="color: #98be65;">"kebab"</span>
    <span style="color: #dcaeea;">result</span> = play_round<span style="color: #FF8811;">(</span>guess, game<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then my guess isn't scored</span>
    <span style="color: #51afef;">assert</span> result.outcome == WordleMoveOutcome.GAME_OVER_LOST, <span style="color: #98be65;">"Should have lost game"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">But game shows "Game Over"</span>
    <span style="color: #51afef;">assert</span> <span style="color: #98be65;">"game over"</span> <span style="color: #51afef;">in</span> result.message.lower<span style="color: #FF8811;">()</span>, <span style="color: #98be65;">"Should show game over message"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And game shows the real answer</span>
    <span style="color: #51afef;">assert</span> answer <span style="color: #51afef;">in</span> result.message


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_winning_guess_wins</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: Winning guess"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Given a wordle answer</span>
    <span style="color: #dcaeea;">answer</span> = <span style="color: #98be65;">"orbit"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And I guessed 3 times</span>
    <span style="color: #dcaeea;">guess_number</span> = <span style="color: #da8548; font-weight: bold;">3</span>
    <span style="color: #dcaeea;">game</span> = WordleGame<span style="color: #FF8811;">(</span>answer, guess_number<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When I guess the word</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And my guess is the answer</span>
    <span style="color: #dcaeea;">guess</span> = answer
    <span style="color: #dcaeea;">result</span> = play_round<span style="color: #FF8811;">(</span>guess, game<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then my guess is scored</span>
    <span style="color: #51afef;">assert</span> result.score <span style="color: #51afef;">is</span> <span style="color: #51afef;">not</span> <span style="color: #a9a1e1;">None</span>, <span style="color: #98be65;">"Guess should be scored"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And the score is perfect</span>
    <span style="color: #51afef;">assert</span> result.score == <span style="color: #98be65;">"&#129001;&#129001;&#129001;&#129001;&#129001;"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And game shows "Game Won</span>
    <span style="color: #51afef;">assert</span> result.outcome == WordleMoveOutcome.GAME_WON, <span style="color: #98be65;">"Should have won game"</span>
    <span style="color: #51afef;">assert</span> <span style="color: #98be65;">"game won"</span> <span style="color: #51afef;">in</span> result.message.lower<span style="color: #FF8811;">()</span>


<span style="color: #5B6268;"># </span><span style="color: #5B6268;">Not a Scenario covered by existing gherkin feature:</span>
<span style="color: #5B6268;"># </span><span style="color: #5B6268;">Intentional, see wordle.org for reasoning</span>
<span style="color: #51afef;">def</span> <span style="color: #c678dd;">test_invalid_guess_not_counted</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Scenario: Invalid guess isn't counted"""</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Given a wordle answer</span>
    <span style="color: #dcaeea;">answer</span> = <span style="color: #98be65;">"orbit"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And I guessed 3 times</span>
    <span style="color: #dcaeea;">guess_number</span> = <span style="color: #da8548; font-weight: bold;">3</span>
    <span style="color: #dcaeea;">game</span> = WordleGame<span style="color: #FF8811;">(</span>answer=answer, guess_number=guess_number<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">When I guess the word</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">But my guess isn't a dictionary word</span>
    <span style="color: #dcaeea;">guess</span> = <span style="color: #98be65;">"xolfy"</span>
    <span style="color: #dcaeea;">result</span> = play_round<span style="color: #FF8811;">(</span>guess, game<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Then my guess is rejected as invalid word</span>
    <span style="color: #dcaeea;">OUTCOME_BADWORD</span> = WordleMoveOutcome.GUESS_NOTVALID_CONTINUE
    <span style="color: #51afef;">assert</span> result.outcome == OUTCOME_BADWORD, <span style="color: #98be65;">"Guess should have been rejected"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">And my guess is not scored</span>
    <span style="color: #51afef;">assert</span> result.score <span style="color: #51afef;">is</span> <span style="color: #a9a1e1;">None</span>, <span style="color: #98be65;">"No score should be given on bad word"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #83898d;">"""Wordle game's state and playing rounds"""</span>


<span style="color: #51afef;">from</span> dataclasses <span style="color: #51afef;">import</span> dataclass
<span style="color: #51afef;">from</span> enum <span style="color: #51afef;">import</span> Enum
<span style="color: #51afef;">from</span> typing <span style="color: #51afef;">import</span> Optional

<span style="color: #51afef;">from</span> literate_wordle.guess <span style="color: #51afef;">import</span> score_guess
<span style="color: #51afef;">from</span> literate_wordle.words <span style="color: #51afef;">import</span> check_valid_word


<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">WordleMoveOutcome</span><span style="color: #FF8811;">(</span>Enum<span style="color: #FF8811;">)</span>:
    <span style="color: #83898d;">"""Outcome of a single move"""</span>

    <span style="color: #dcaeea;">GAME_OVER_LOST</span> = <span style="color: #da8548; font-weight: bold;">1</span>
    <span style="color: #dcaeea;">GAME_WON</span> = <span style="color: #da8548; font-weight: bold;">2</span>
    <span style="color: #dcaeea;">GUESS_SCORED_CONTINUE</span> = <span style="color: #da8548; font-weight: bold;">3</span>
    <span style="color: #dcaeea;">GUESS_NOTVALID_CONTINUE</span> = <span style="color: #da8548; font-weight: bold;">4</span>


<span style="color: #ECBE7B;">@dataclass</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">WordleGame</span>:
    <span style="color: #83898d;">"""A Wordle game's internal state, before a move is played"""</span>

    answer: <span style="color: #c678dd;">str</span>
    guess_number: <span style="color: #c678dd;">int</span>


<span style="color: #ECBE7B;">@dataclass</span>
<span style="color: #51afef;">class</span> <span style="color: #ECBE7B;">WordleMove</span>:
    <span style="color: #83898d;">"""A Wordle game state once a move is played"""</span>

    game: WordleGame
    outcome: WordleMoveOutcome
    message: <span style="color: #c678dd;">str</span>
    score: Optional<span style="color: #FF8811;">[</span><span style="color: #c678dd;">str</span><span style="color: #FF8811;">]</span>


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">play_round</span><span style="color: #FF8811;">(</span>guess: <span style="color: #c678dd;">str</span>, game: WordleGame<span style="color: #FF8811;">)</span> -&gt; WordleMove:
    <span style="color: #83898d;">"""Use guess on the given game, resulting in WordleMove"""</span>
    <span style="color: #51afef;">if</span> game.guess_number &gt;= <span style="color: #da8548; font-weight: bold;">6</span>:
        <span style="color: #dcaeea;">message</span> = f<span style="color: #98be65;">"Too many guesses: Game Over. Answer was: {game.answer}"</span>
        <span style="color: #dcaeea;">outcome</span> = WordleMoveOutcome.GAME_OVER_LOST
        <span style="color: #51afef;">return</span> WordleMove<span style="color: #FF8811;">(</span>game=game, outcome=outcome, message=message, score=<span style="color: #a9a1e1;">None</span><span style="color: #FF8811;">)</span>
    <span style="color: #dcaeea;">valid</span>, <span style="color: #dcaeea;">validity_msg</span> = check_valid_word<span style="color: #FF8811;">(</span>guess<span style="color: #FF8811;">)</span>
    <span style="color: #51afef;">if</span> <span style="color: #51afef;">not</span> valid <span style="color: #51afef;">and</span> validity_msg <span style="color: #51afef;">is</span> <span style="color: #51afef;">not</span> <span style="color: #a9a1e1;">None</span>:
        <span style="color: #dcaeea;">outcome</span> = WordleMoveOutcome.GUESS_NOTVALID_CONTINUE
        <span style="color: #51afef;">return</span> WordleMove<span style="color: #FF8811;">(</span>game=game, outcome=outcome, message=validity_msg, score=<span style="color: #a9a1e1;">None</span><span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Guess now guaranteed to be valid: count it</span>
    <span style="color: #dcaeea;">game.guess_number</span> += <span style="color: #da8548; font-weight: bold;">1</span>
    <span style="color: #dcaeea;">score</span> = score_guess<span style="color: #FF8811;">(</span>guess, game.answer<span style="color: #FF8811;">)</span>
    <span style="color: #51afef;">if</span> score == <span style="color: #98be65;">"&#129001;&#129001;&#129001;&#129001;&#129001;"</span>:
        <span style="color: #dcaeea;">outcome</span> = WordleMoveOutcome.GAME_WON
        <span style="color: #dcaeea;">message</span> = f<span style="color: #98be65;">"Correct! Game won in {game.guess_number - 1} guesses"</span>
        <span style="color: #51afef;">return</span> WordleMove<span style="color: #FF8811;">(</span>game=game, outcome=outcome, message=message, score=score<span style="color: #FF8811;">)</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Only case left is "try another guess"</span>
    <span style="color: #dcaeea;">outcome</span> = WordleMoveOutcome.GUESS_SCORED_CONTINUE
    <span style="color: #dcaeea;">message</span> = f<span style="color: #98be65;">"Try again! Guess number {game.guess_number - 1}. Score is: {score}"</span>
    <span style="color: #51afef;">return</span> WordleMove<span style="color: #FF8811;">(</span>game=game, outcome=outcome, message=message, score=score<span style="color: #FF8811;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org057af63" class="outline-2">
<h2 id="org057af63"><span class="section-number-2">5.</span> Final round: command line interface</h2>
<div class="outline-text-2" id="text-5">
<p>
We have assembled lego bricks into an almost finished product, as we have enough to
play a single round. Let&rsquo;s give this project a shell command to invoke, tying
together all the other disjointed features.
</p>

<div class="org-src-container">
<pre class="src src-feature"><span style="color: #51afef;">Feature:</span><span style="color: #ECBE7B;"> Pywordle shell command</span>
  As a Wordle game
  I need a shell command to launch the game
  In order to give convenient entrypoint for players
</pre>
</div>

<p>
I don&rsquo;t think it&rsquo;s necessary to give specific scenarios, because we&rsquo;ve
thoroughly tested the underlying implementation of the game, we just need to
assemble it into a shell command.
</p>

<p>
So let&rsquo;s define an entrypoint for the game, generating a new one:
</p>

<div class="org-src-container">
<pre class="src src-python" id="org888b6b3"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">new_game</span><span style="color: #FF8811;">()</span> -&gt; WordleGame:
    <span style="color: #83898d;">"""Generate a new WordleGame"""</span>
    <span style="color: #51afef;">return</span> WordleGame<span style="color: #FF8811;">(</span>answer=pick_answer_word<span style="color: #8F0;">()</span>, guess_number=<span style="color: #da8548; font-weight: bold;">1</span><span style="color: #FF8811;">)</span>
</pre>
</div>

<p>
And how to play until we lose, printing to stdout as we go:
</p>

<div class="org-src-container">
<pre class="src src-python" id="org05913d0"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">play_game</span><span style="color: #FF8811;">(</span>game: WordleGame, guess_fetcher: Callable, response_logger: Callable<span style="color: #FF8811;">)</span>:
    <span style="color: #83898d;">"""Plays the given WordleGame until completion.</span>

<span style="color: #83898d;">    Asks guess_fetcher for guess, and prints response to response_logger</span>
<span style="color: #83898d;">    """</span>
    <span style="color: #dcaeea;">outcome</span> = WordleMoveOutcome.GUESS_SCORED_CONTINUE  <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Gotta start somehow</span>
    <span style="color: #51afef;">while</span> outcome <span style="color: #51afef;">not</span> <span style="color: #51afef;">in</span> <span style="color: #FF8811;">{</span>WordleMoveOutcome.GAME_WON, WordleMoveOutcome.GAME_OVER_LOST<span style="color: #FF8811;">}</span>:
        <span style="color: #dcaeea;">guess</span> = guess_fetcher<span style="color: #FF8811;">()</span>
        <span style="color: #dcaeea;">result</span> = play_round<span style="color: #FF8811;">(</span>guess=guess, game=game<span style="color: #FF8811;">)</span>
        response_logger<span style="color: #FF8811;">(</span>result.message<span style="color: #FF8811;">)</span>
        <span style="color: #dcaeea;">game</span> = result.game
        <span style="color: #dcaeea;">outcome</span> = result.outcome
</pre>
</div>

<p>
Note how both the guess and the response are dependency-injected, to allow for
fully automated testing later (though we won&rsquo;t use that too much).
</p>

<p>
Add a few imports needed:
</p>

<div class="org-src-container">
<pre class="src src-python" id="orgb686094"><span style="color: #51afef;">from</span> typing <span style="color: #51afef;">import</span> Callable
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python" id="orgb257586"><span style="color: #51afef;">from</span> literate_wordle.game <span style="color: #51afef;">import</span> WordleGame, WordleMoveOutcome, play_round
<span style="color: #51afef;">from</span> literate_wordle.words <span style="color: #51afef;">import</span> pick_answer_word
</pre>
</div>

<p>
Now we can add command line argument parsing in a separate file:
</p>


<div class="org-src-container">
<pre class="src src-python" id="org4302431"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">parse_args</span><span style="color: #FF8811;">(</span>raw_args: List<span style="color: #8F0;">[</span><span style="color: #c678dd;">str</span><span style="color: #8F0;">]</span><span style="color: #FF8811;">)</span> -&gt; argparse.Namespace:
    <span style="color: #83898d;">"""Parse given command line arguments"""</span>
    <span style="color: #dcaeea;">description</span> = <span style="color: #98be65;">"Wordle implementation in Python, as literate programming"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Bit overkill since there is no real argument to parse yet</span>
    <span style="color: #dcaeea;">parser</span> = argparse.ArgumentParser<span style="color: #FF8811;">(</span>prog=<span style="color: #98be65;">"pywordle"</span>, description=description<span style="color: #FF8811;">)</span>
    <span style="color: #51afef;">return</span> parser.parse_args<span style="color: #FF8811;">(</span>raw_args<span style="color: #FF8811;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python" id="orgaf6cc5d"><span style="color: #51afef;">import</span> argparse
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org7420da6"><span style="color: #51afef;">from</span> typing <span style="color: #51afef;">import</span> List
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org812518b"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">play_game_args</span><span style="color: #FF8811;">(</span>raw_args: List<span style="color: #8F0;">[</span><span style="color: #c678dd;">str</span><span style="color: #8F0;">]</span><span style="color: #FF8811;">)</span>:
    <span style="color: #83898d;">"""Play a standard Wordle game from stdin to stdout, given args"""</span>
    <span style="color: #dcaeea;">_</span> = parse_args<span style="color: #FF8811;">(</span>raw_args<span style="color: #FF8811;">)</span>
    <span style="color: #dcaeea;">game</span> = new_game<span style="color: #FF8811;">()</span>
    play_game<span style="color: #FF8811;">(</span>game=game, guess_fetcher=<span style="color: #c678dd;">input</span>, response_logger=<span style="color: #51afef;">print</span><span style="color: #FF8811;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org780474f"><span style="color: #51afef;">def</span> <span style="color: #c678dd;">main</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Pass sys.argv to the play_game_args function"""</span>
    play_game_args<span style="color: #FF8811;">(</span>sys.argv<span style="color: #8F0;">[</span><span style="color: #da8548; font-weight: bold;">1</span>:<span style="color: #8F0;">]</span><span style="color: #FF8811;">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org4d5d82c"><span style="color: #51afef;">import</span> sys
</pre>
</div>

<div class="org-src-container">
<pre class="src src-python" id="org92a5113"><span style="color: #51afef;">from</span> literate_wordle.main <span style="color: #51afef;">import</span> new_game, play_game
</pre>
</div>

<p>
Since both our main and cli are meant to be untestable, because it&rsquo;s the
interactive entrypoint, it&rsquo;s a bit unfair to compute coverage over it. Let&rsquo;s
blacklist these two files, preventing them weighing down coverage metric.
</p>

<div class="org-src-container">
<pre class="src src-conf">[<span style="color: #ECBE7B;">run</span>]
<span style="color: #dcaeea;">omit</span> =
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Don't compute coverage for these 2 manual invocation files</span>
    src/literate_wordle/main.py
    src/literate_wordle/cli.py
</pre>
</div>
</div>

<div id="outline-container-org1771393" class="outline-3">
<h3 id="org1771393"><span class="section-number-3">5.1.</span> Tangling it out</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">
<pre class="src src-python"><span style="color: #83898d;">"""Entrypoint for pywordle"""</span>


<span style="color: #51afef;">from</span> typing <span style="color: #51afef;">import</span> Callable

<span style="color: #51afef;">from</span> literate_wordle.game <span style="color: #51afef;">import</span> WordleGame, WordleMoveOutcome, play_round
<span style="color: #51afef;">from</span> literate_wordle.words <span style="color: #51afef;">import</span> pick_answer_word


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">new_game</span><span style="color: #FF8811;">()</span> -&gt; WordleGame:
    <span style="color: #83898d;">"""Generate a new WordleGame"""</span>
    <span style="color: #51afef;">return</span> WordleGame<span style="color: #FF8811;">(</span>answer=pick_answer_word<span style="color: #8F0;">()</span>, guess_number=<span style="color: #da8548; font-weight: bold;">1</span><span style="color: #FF8811;">)</span>


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">play_game</span><span style="color: #FF8811;">(</span>game: WordleGame, guess_fetcher: Callable, response_logger: Callable<span style="color: #FF8811;">)</span>:
    <span style="color: #83898d;">"""Plays the given WordleGame until completion.</span>

<span style="color: #83898d;">    Asks guess_fetcher for guess, and prints response to response_logger</span>
<span style="color: #83898d;">    """</span>
    <span style="color: #dcaeea;">outcome</span> = WordleMoveOutcome.GUESS_SCORED_CONTINUE  <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Gotta start somehow</span>
    <span style="color: #51afef;">while</span> outcome <span style="color: #51afef;">not</span> <span style="color: #51afef;">in</span> <span style="color: #FF8811;">{</span>WordleMoveOutcome.GAME_WON, WordleMoveOutcome.GAME_OVER_LOST<span style="color: #FF8811;">}</span>:
        <span style="color: #dcaeea;">guess</span> = guess_fetcher<span style="color: #FF8811;">()</span>
        <span style="color: #dcaeea;">result</span> = play_round<span style="color: #FF8811;">(</span>guess=guess, game=game<span style="color: #FF8811;">)</span>
        response_logger<span style="color: #FF8811;">(</span>result.message<span style="color: #FF8811;">)</span>
        <span style="color: #dcaeea;">game</span> = result.game
        <span style="color: #dcaeea;">outcome</span> = result.outcome



</pre>
</div>


<div class="org-src-container">
<pre class="src src-python"><span style="color: #83898d;">"""Command line entrypoint for pywordle"""</span>


<span style="color: #51afef;">import</span> argparse
<span style="color: #51afef;">import</span> sys
<span style="color: #51afef;">from</span> typing <span style="color: #51afef;">import</span> List

<span style="color: #51afef;">from</span> literate_wordle.main <span style="color: #51afef;">import</span> new_game, play_game


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">parse_args</span><span style="color: #FF8811;">(</span>raw_args: List<span style="color: #8F0;">[</span><span style="color: #c678dd;">str</span><span style="color: #8F0;">]</span><span style="color: #FF8811;">)</span> -&gt; argparse.Namespace:
    <span style="color: #83898d;">"""Parse given command line arguments"""</span>
    <span style="color: #dcaeea;">description</span> = <span style="color: #98be65;">"Wordle implementation in Python, as literate programming"</span>
    <span style="color: #5B6268;"># </span><span style="color: #5B6268;">Bit overkill since there is no real argument to parse yet</span>
    <span style="color: #dcaeea;">parser</span> = argparse.ArgumentParser<span style="color: #FF8811;">(</span>prog=<span style="color: #98be65;">"pywordle"</span>, description=description<span style="color: #FF8811;">)</span>
    <span style="color: #51afef;">return</span> parser.parse_args<span style="color: #FF8811;">(</span>raw_args<span style="color: #FF8811;">)</span>


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">play_game_args</span><span style="color: #FF8811;">(</span>raw_args: List<span style="color: #8F0;">[</span><span style="color: #c678dd;">str</span><span style="color: #8F0;">]</span><span style="color: #FF8811;">)</span>:
    <span style="color: #83898d;">"""Play a standard Wordle game from stdin to stdout, given args"""</span>
    <span style="color: #dcaeea;">_</span> = parse_args<span style="color: #FF8811;">(</span>raw_args<span style="color: #FF8811;">)</span>
    <span style="color: #dcaeea;">game</span> = new_game<span style="color: #FF8811;">()</span>
    play_game<span style="color: #FF8811;">(</span>game=game, guess_fetcher=<span style="color: #c678dd;">input</span>, response_logger=<span style="color: #51afef;">print</span><span style="color: #FF8811;">)</span>


<span style="color: #51afef;">def</span> <span style="color: #c678dd;">main</span><span style="color: #FF8811;">()</span>:
    <span style="color: #83898d;">"""Pass sys.argv to the play_game_args function"""</span>
    play_game_args<span style="color: #FF8811;">(</span>sys.argv<span style="color: #8F0;">[</span><span style="color: #da8548; font-weight: bold;">1</span>:<span style="color: #8F0;">]</span><span style="color: #FF8811;">)</span>
</pre>
</div>
</div>
</div>


<div id="outline-container-org57b18c3" class="outline-3">
<h3 id="org57b18c3"><span class="section-number-3">5.2.</span> Launching as CLI</h3>
<div class="outline-text-3" id="text-5-2">
<p>
In Python, when using <a href="https://python-poetry.org/">Poetry</a> like we are, the package is defined in
<code>pyproject.toml</code>. To define a new command, this means using the
<code>tool.poetry.script</code> key:
</p>

<div class="org-src-container">
<pre class="src src-conf">[<span style="color: #ECBE7B;">tool.poetry.scripts</span>]
<span style="color: #dcaeea;">pywordle</span> = <span style="color: #98be65;">"literate_wordle.cli:main"</span>
</pre>
</div>

<p>
So we can now manually invoke this tool. And for the given argument parser, a
help message should be available:
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 46: </span>Invoking the help menu. Note &ldquo;poetry run&rdquo; prefix to ensure we&rsquo;re running inside virtualenv, where the package is installed</label><pre class="src src-shell">poetry run pywordle --help
</pre>
</div>

<pre class="example">
usage: pywordle [-h]

Wordle implementation in Python, as literate programming

optional arguments:
  -h, --help  show this help message and exit
</pre>


<p>
And we can play a round!
</p>

<div class="result" id="org7617acc">
<p>
$ poetry shell
$ pywordle
hello
Try again! Guess number 1. Score is: ⬜🟨🟨⬜🟨
lobes
Try again! Guess number 2. Score is: 🟨🟩⬜🟩⬜
cranes
Guess too long
crane
Try again! Guess number 3. Score is: ⬜⬜⬜🟨🟨
novel
Correct! Game won in 4 guesses
</p>

</div>

<p>
Taking a step back, we&rsquo;ve got command line launch of the game, and it gave
us proper play feature. We&rsquo;re done here, especially for a short experimental
project like this one.
</p>

<p>
But if this codebase was to be maintained, extended, reused, the bar for
&ldquo;acceptable&rdquo; test coverage would be much higher.
</p>

<p>
For instance, we have no test overall on the game loop of guess input/output,
despite all the layers below being pretty well covered. So I&rsquo;d want tests that
call the <code>play_game</code> function with scripted inputs and log the outputs, taking
advantage of the dependency injection we set up to make proper UI-oriented
tests. These would reveal, for instance, that when launching the game, there is
nothing greeting us, no prompt for a guess, which is a usability issue.
</p>

<p>
Remember that testing&rsquo;s primary goal is to increase our trust in the system we
build.
</p>

<p>
In that vein, because we&rsquo;ve got feature acceptance tests covered for every
layer, the biggest source of uncertainty in the system is the implementation
itself: we&rsquo;re just not shaking out the code very much, beyond what a normal
usage would look like. This calls for exploring the edge cases that code may
have, regardless of intended features. Every string parameter should be tried
with empty string, uppercase vs lowercase, different encoding, etc.
</p>

<p>
To give ideas on how to do this, I recently rediscovered that there&rsquo;s an
interesting way to look for code that wasn&rsquo;t yet tested much: Use test coverage
measurements, show lines that no tests hit (<code>if</code> that never get triggered), and
build tests around that. Obviously, this won&rsquo;t be sufficient to get all the
issues<sup><a id="fnr.4" class="footref" href="#fn.4" role="doc-backlink">4</a></sup>, but it&rsquo;s a good way to poke at existing test code.
</p>
</div>
</div>
</div>
<div id="outline-container-orga4a8388" class="outline-2">
<h2 id="orga4a8388"><span class="section-number-2">6.</span> Conclusion</h2>
<div class="outline-text-2" id="text-6">
<p>
We just walked through building a simple wordle program from scratch, using
literate programming to weave a novel&rsquo;s worth of explanations and reasoning,
with code blocks that export to the proper project code locations.
</p>

<p>
The project uses modern Python tooling (poetry, pytest) and uses formatters
(black, isort), linters (flake8 with plugins), type checkers (mypy), and the
project generates its own general documentation (including this page, if you&rsquo;re
reading it in a browser) and API reference (Sphinx with myst_parser for Markdown
support), enforcing compliance of every tool via make and pre-commit.
</p>

<p>
The code was written in a Test-driven (TDD) way, as the tests always came before
the feature itself, guiding how the implementation looks like, all the way to
having 100% test coverage (whatever that means).
</p>

<p>
More importantly in my eyes, we only built what was strictly necessary, by using
Behaviour-driven development (BDD, also called acceptance-test-driven
development) to guide what subfeature to build next based on our needs. These
specifications were encoded as Gherkin Features, available in a dedicated
<code>features/</code> folder, and thanks to the magic of Sphinx documentation, each of
those are collected into a list of requirements in a dedicated Requirements
page of the docs.
</p>

<p>
Since all of the feature files have associated acceptance tests that match the
phrasing of the Gherkin features, future automation work could look at linking
the requirements in Sphinx to the associated test file, so as to finally get
full traceability from requirements, through specifications, to implementation
and finally acceptance tests that pass.
</p>

<p>
This project was my first foray into literate programming at this scale, an
attempt to bring together all the good ideas of TDD, modern Python development,
Gherkin usage for requirements traceability purposes (without overly zealous
extremes of Cucumber automation). All these ideas were until now scattered,
implemented each without the others in different places, and this project
fuses them into something I hope is more valuable than the sum of its parts.
</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1" role="doc-backlink">1</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">Keen readers will notice
sub-optimal code, such as re-unzipping the entire solutions file
before any picking of solution. Indeed, these are valid points. But in the
context of this project, these are accepted tradeoffs leaning towards
legibility/simplicity of implementation against raw performance. Considering
that &ldquo;picking a solution word&rdquo; is something done on the order of <i>once</i> over the
entire runtime, we can afford it.</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2" role="doc-backlink">2</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">Usual TDD cycle adds a refactor/blue cycle, which is indeed necessary
for production code, as it lends to maintainability. This code is intended as
entertainment material, with this literate-programming article as companion.
Refactoring would mean refactoring the <code>wordle.org</code> source file, which would
drown out the nice narrative we&rsquo;re building here.</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3" role="doc-backlink">3</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">Obviously coverage
metric is a very fuzzy number which doesn&rsquo;t guarantee much, but most well maintained code has a
tendency to have good coverage, because the features are well tested. It&rsquo;s a
correlation-metric, nothing more. In our case, we&rsquo;re doing TDD (test goes first
indeed) and we&rsquo;re pushing this even more to explicit our user requirements as
acceptance tests, it should be no surprise the coverage gets good.</p></div></div>

<div class="footdef"><sup><a id="fn.4" class="footnum" href="#fnr.4" role="doc-backlink">4</a></sup> <div class="footpara" role="doc-footnote"><p class="footpara">Test coverage marks a line as &ldquo;covered&rdquo; if it is hit by any test, but
not why and how in depth. Classic example is for loops, which mark the loop as
covered, but the loop could have been hit only once, hiding edge cases when the
feature iterates over the loop multiple (or no) times. As always, this is at
best a fun heuristic.</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="author">Author: Jb Doyon</p>
<p class="date">Created: 2022-03-21 Mon 02:09</p>
</div>
</body>
</html>
